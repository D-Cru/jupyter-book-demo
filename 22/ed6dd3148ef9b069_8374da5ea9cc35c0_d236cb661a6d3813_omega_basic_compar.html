
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Comparison Notebook &#8212; Jupyter Book Demo</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/ngl.js"></script>
    <script src="../_static/test.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Jupyter Book Demo</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="intro_22.html">
   1. Compound 22
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ed6dd3148ef9b069_GaMD_processed.html">
     1.1. Analysis Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ed6dd3148ef9b069_GaMD_interactive.html">
     1.2. Interactive exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="568b39635b10fbba_GaMD_processed.html">
     1.3. Analysis Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="a61763fc40176038_GaMD_processed.html">
     1.4. Analysis Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../24/e8dd07e57d6e2799_GaMD_processed.html">
     1.5. Analysis Notebook
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks.html">
   2. Content with notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown.html">
   3. Markdown Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../there_test.html">
   4. TEST
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/d-cru/test_report/main?urlpath=tree/test_report/22/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/d-cru/test_report"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d-cru/test_report/issues/new?title=Issue%20on%20page%20%2F22/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/22/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Comparison Notebook</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="comparison-notebook">
<h1>Comparison Notebook<a class="headerlink" href="#comparison-notebook" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#matplotlib.use(&quot;Agg&quot;)</span>

<span class="kn">import</span> <span class="nn">mdtraj</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.cluster.hierarchy</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">squareform</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="kn">import</span> <span class="nn">src</span>
<span class="kn">from</span> <span class="nn">src.noe</span> <span class="kn">import</span> <span class="n">compute_NOE_mdtraj</span><span class="p">,</span> <span class="n">plot_NOE</span>
<span class="kn">from</span> <span class="nn">src.utils</span> <span class="kn">import</span> <span class="n">json_load</span><span class="p">,</span> <span class="n">dotdict</span>

<span class="kn">import</span> <span class="nn">src.pyreweight</span>
<span class="kn">from</span> <span class="nn">src.analyse</span> <span class="kn">import</span> <span class="n">getDih</span><span class="p">,</span> <span class="n">getOmega</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read in stride from config file</span>
<span class="n">stride</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stride&#39;</span><span class="p">])</span>
<span class="n">stride</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compound_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">compound_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysing Compound </span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analysing Compound 22
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compound</span> <span class="o">=</span> <span class="n">json_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">parm</span><span class="p">)</span>
<span class="n">multi</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">multi</span>
<span class="n">multi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">multiple</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Multiple compounds detected&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">multiple</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Single compound only (no exp. cis/trans data known)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Single compound only (no exp. cis/trans data known)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Trajectories</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;data/interim/refactor-test/22/NOE.json&#39;,
 &#39;data/interim/refactor-test/22/data.json&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/2000/0/ed6dd3148ef9b069_weights.dat&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/2000/0/ed6dd3148ef9b069_md.out&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/2000/0/ed6dd3148ef9b069_traj.netcdf&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/2000/0/ed6dd3148ef9b069_traj.ncdf&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_clusters/clusters.pdb&#39;,
 &#39;data/interim/refactor-test/22/H2O/1_make_topology/mc_sol.prmtop&#39;,
 &#39;data/interim/refactor-test/22/omega/basic/mcs.pdb&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_dihedrals.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_dPCA.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_dPCA_weights_MC.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_NOE_dist.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_multiple.dat&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/1000/0/8374da5ea9cc35c0_weights.dat&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/1000/0/8374da5ea9cc35c0_md.out&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/1000/0/8374da5ea9cc35c0_traj.netcdf&#39;,
 &#39;data/interim/refactor-test/22/H2O/11_GaMD_full/1000/0/8374da5ea9cc35c0_traj.ncdf&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_clusters/clusters.pdb&#39;,
 &#39;data/interim/refactor-test/22/H2O/1_make_topology/mc_sol.prmtop&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_dihedrals.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_dPCA.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_dPCA_weights_MC.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_NOE_dist.dat&#39;,
 &#39;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_multiple.dat&#39;,
 &#39;data/interim/refactor-test/22/Chloroform/11_GaMD_full/1000/0/d236cb661a6d3813_weights.dat&#39;,
 &#39;data/interim/refactor-test/22/Chloroform/11_GaMD_full/1000/0/d236cb661a6d3813_md.out&#39;,
 &#39;data/interim/refactor-test/22/Chloroform/11_GaMD_full/1000/0/d236cb661a6d3813_traj.netcdf&#39;,
 &#39;data/interim/refactor-test/22/Chloroform/11_GaMD_full/1000/0/d236cb661a6d3813_traj.ncdf&#39;,
 &#39;data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_clusters/clusters.pdb&#39;,
 &#39;data/interim/refactor-test/22/Chloroform/1_make_topology/mc_sol.prmtop&#39;,
 &#39;data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_dihedrals.dat&#39;,
 &#39;data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_dPCA.dat&#39;,
 &#39;data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_dPCA_weights_MC.dat&#39;,
 &#39;data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_NOE_dist.dat&#39;,
 &#39;data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_multiple.dat&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#trajs = {}</span>
<span class="n">methods</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">repeats</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">simtime</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">solvent</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">boosting</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1">#protein = md.load_frame(snakemake.input[f&quot;traj_{i}&quot;], 0, top=snakemake.input[f&quot;top_{i}&quot;])</span>
    <span class="c1">#protein = protein.topology.select(&#39;protein&#39;)</span>
    <span class="c1"># Load topology</span>
    <span class="c1">#trajs[i] = md.load(snakemake.input[f&quot;traj_{i}&quot;], top=snakemake.input[f&quot;top_{i}&quot;], atom_indices=protein, stride=stride)</span>
    <span class="c1"># save methods</span>
    <span class="n">methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sample_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s1">&#39;method&#39;</span><span class="p">]</span>
    <span class="n">simtime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sample_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s1">&#39;simtime&#39;</span><span class="p">]</span>
    <span class="n">repeats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sample_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s1">&#39;repeats&#39;</span><span class="p">]</span>
    <span class="n">solvent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sample_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s1">&#39;solvent&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sample_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s1">&#39;igamd&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;nan&quot;</span><span class="p">:</span>
        <span class="n">boost</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;sample_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="s1">&#39;igamd&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">boost</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">boosting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;boost: dual&quot;</span>
        <span class="k">elif</span> <span class="n">boost</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">boosting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;boost: dihe&quot;</span>
        <span class="k">elif</span> <span class="n">boost</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">boosting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;boost: totE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">boosting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    
    <span class="c1"># Remove solvent</span>
    <span class="c1">#trajs[i] = trajs[i].restrict_atoms(trajs[i].topology.select(&#39;protein&#39;))</span>
    <span class="c1">#if snakemake.params[f&quot;sample_{i}&quot;][&#39;method&#39;] == &quot;GaMD&quot;:</span>
        <span class="c1">#trajs[i] = trajs[i][int(26000/stride):]</span>
        <span class="c1">#print(&quot;GAMD&quot;)</span>
    <span class="c1"># Superpose</span>
    <span class="c1">#trajs[i].superpose(trajs[i], 0)</span>
    <span class="c1">#snakemake.input[f&quot;out_{i}&quot;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#trajs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;out_0&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/interim/refactor-test/22/H2O/11_GaMD_full/2000/0/ed6dd3148ef9b069_md.out&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">confgen</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
    <span class="n">chem_info_t</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">cheminfoconfs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chem_info_t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;mdtraj.Trajectory with 400 frames, 71 atoms, 5 residues, without unitcells&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="n">cis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="c1">#         ca_c = trajs[i].top.select(f&quot;resid 0 and name CA C&quot;)</span>
<span class="c1">#         n_ca_next = trajs[i].top.select(f&quot;resid 1 and name N CA&quot;)</span>

<span class="c1">#         omega = np.append(ca_c, n_ca_next)</span>
<span class="c1">#         t_omega_rad = md.compute_dihedrals(trajs[i], [omega])</span>
<span class="c1">#         t_omega_deg = np.abs(np.degrees(t_omega_rad))</span>
<span class="c1">#         plt.plot(t_omega_deg)</span>
<span class="c1">#         plt.hlines(90, 0, 50000, color=&#39;red&#39;)</span>
        <span class="n">cis_temp</span><span class="p">,</span> <span class="n">trans_temp</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;multiple_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
        <span class="n">cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cis_temp</span><span class="p">)</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans_temp</span><span class="p">)</span>
        <span class="c1">#t_a[trans]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dihe_all</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">dihe_all</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;red_dihe_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">confgen</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
    <span class="n">dihe_conf</span> <span class="o">=</span> <span class="n">getDih</span><span class="p">(</span><span class="n">chem_info_t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dihe_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000000, 30)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dihe</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">dPCA_1</span><span class="p">)</span><span class="c1">#PCA(n_components=2)</span>
<span class="n">dihe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dihe_all</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dihe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># Now apply the same transformation to second and third</span>
<span class="n">dihe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dihe_all</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">dihe</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dihe_all</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">confgen</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
    <span class="n">dihe_red_conf</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dihe_conf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">methods</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">confgen</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dihe_red_conf</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dihe_red_conf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar_19_0.png" src="../_images/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar_19_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># How much of the variance is explained by the 2 components?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The two components explain </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of the variance&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The two components explain 52.66% of the variance
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#snakemake.input[f&quot;weights_{1}&quot;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reweighting:</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">weight_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;dPCA_weights_MC_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
<span class="c1">#     if methods[i] != &#39;cMD&#39;:</span>
<span class="c1">#         weight_data[i] = np.loadtxt(snakemake.input[f&quot;weights_{i}&quot;])</span>
<span class="c1">#         weight_data[i] = weight_data[i][::stride]</span>
<span class="c1">#         weights[i] = src.reweight(dihe[i], snakemake.input[f&quot;weights_{i}&quot;], &#39;amdweight_MC&#39;, weight_data[i])</span>
<span class="c1">#     else:</span>
<span class="c1">#         weights[i] = src.reweight(dihe[i], None, &#39;noweight&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.474566392729406
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">min_</span><span class="p">,</span> <span class="n">max_</span> <span class="o">=</span> <span class="n">zs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">zs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">min_</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_</span> <span class="o">=</span> <span class="mi">8</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot re-weighted PCA plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">scat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">scat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">min_</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">simtime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ns (r# </span><span class="si">{</span><span class="n">repeats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">).</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">solvent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">boosting</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">confgen</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dihe_red_conf</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dihe_red_conf</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">confgen</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
<span class="n">lgnd</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">lgnd</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">:</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_sizes</span><span class="p">([</span><span class="mf">30.0</span><span class="p">])</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>



<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Overlay&#39;</span><span class="p">)</span>

<span class="n">colorbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kcal/mol&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="c1">#fig.tight_layout()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">pca_dihe</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar_27_0.png" src="../_images/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar_27_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load cluster data</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;clusters_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clust_struct</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;clusters_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">clust_struct</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clust_struct</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>data/processed/refactor-test/results/22/H2O/GaMD/2000/0/ed6dd3148ef9b069_clusters/clusters.pdb
data/processed/refactor-test/results/22/H2O/GaMD/1000/0/8374da5ea9cc35c0_clusters/clusters.pdb
data/processed/refactor-test/results/22/Chloroform/GaMD/1000/0/d236cb661a6d3813_clusters/clusters.pdb
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transform clusters in pca</span>
<span class="n">clusters_dih</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">[</span><span class="n">clusters_dih</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getDih</span><span class="p">(</span><span class="n">clus</span><span class="p">))</span> <span class="k">for</span> <span class="n">clus</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span>
<span class="n">cluster_pca</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">[</span><span class="n">cluster_pca</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">clus</span><span class="p">))</span> <span class="k">for</span> <span class="n">clus</span> <span class="ow">in</span> <span class="n">clusters_dih</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[None, None, None]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Clusters</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dihe</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

<span class="c1"># Plot clusters</span>
<span class="k">for</span> <span class="n">clus</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_pca</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">methods</span><span class="o">.</span><span class="n">values</span><span class="p">())):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">clus</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">clus</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clus</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]))):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">clus</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">clus</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Different clusters on dPCA plot&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_pca</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar_30_0.png" src="../_images/ed6dd3148ef9b069_8374da5ea9cc35c0_d236cb661a6d3813_omega_basic_compar_30_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Backbone RMSD between clusters. Array indices correspond to the cluster number in plot above.&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations_with_replacement</span>
<span class="n">cluster_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">method_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">methods</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_pairs</span><span class="p">,</span> <span class="n">method_pairs</span><span class="p">):</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">i_n</span><span class="p">,</span> <span class="n">j_n</span> <span class="o">=</span> <span class="n">w</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSD between </span><span class="si">{</span><span class="n">i_n</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">j_n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">rmsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">n_frames</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">n_frames</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">n_frames</span><span class="p">):</span>
            <span class="n">rmsd</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">rmsd</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">atom_indices</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rmsd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Backbone RMSD between clusters. Array indices correspond to the cluster number in plot above.
RMSD between GaMD - GaMD
[[0.00000000e+00 1.21022213e+00 1.35723615e+00 1.03750694e+00
  1.44424808e+00 1.54721403e+00 1.34796882e+00 1.04486990e+00
  1.35072482e+00 8.27648282e-01 1.38940382e+00 1.25898898e+00
  1.29147112e+00 8.71032000e-01 1.26768816e+00 1.16353226e+00
  1.40258491e+00]
 [1.21022213e+00 0.00000000e+00 6.79472804e-01 5.91886699e-01
  1.45834506e+00 1.77104568e+00 1.76767802e+00 1.56117499e+00
  1.31897092e+00 1.46207821e+00 1.43353999e+00 1.64951026e+00
  1.70039773e+00 1.29005814e+00 8.58871996e-01 1.70099866e+00
  1.73840773e+00]
 [1.35723615e+00 6.79472804e-01 0.00000000e+00 9.05123889e-01
  1.37692153e+00 1.59790766e+00 1.68821228e+00 1.72049940e+00
  1.43183887e+00 1.46739113e+00 1.17808366e+00 1.69609964e+00
  1.80019069e+00 1.45066500e+00 1.05815685e+00 1.82808816e+00
  1.73901689e+00]
 [1.03750694e+00 5.91886699e-01 9.05123889e-01 0.00000000e+00
  1.43878567e+00 1.71668673e+00 1.60356236e+00 1.55115080e+00
  1.38883734e+00 1.32914197e+00 1.25670063e+00 1.71072948e+00
  1.75486028e+00 1.25879478e+00 7.95539618e-01 1.61796260e+00
  1.70377111e+00]
 [1.44424808e+00 1.45834506e+00 1.37692153e+00 1.43878567e+00
  0.00000000e+00 1.05184448e+00 1.39211416e+00 1.81983018e+00
  9.79789555e-01 1.56632650e+00 1.38577890e+00 1.76606607e+00
  1.80165470e+00 1.75867343e+00 1.74491656e+00 1.92834961e+00
  1.96058857e+00]
 [1.54721403e+00 1.77104568e+00 1.59790766e+00 1.71668673e+00
  1.05184448e+00 0.00000000e+00 7.44550467e-01 1.50904894e+00
  1.48072851e+00 1.49227881e+00 1.47026348e+00 1.45428824e+00
  1.72079515e+00 1.90232337e+00 1.93198276e+00 1.76829147e+00
  1.51956201e+00]
 [1.34796929e+00 1.76767766e+00 1.68821192e+00 1.60356236e+00
  1.39211464e+00 7.44550467e-01 0.00000000e+00 1.27416563e+00
  1.67132044e+00 1.33244336e+00 1.36388493e+00 1.43582797e+00
  1.66474628e+00 1.70392013e+00 1.82027757e+00 1.52198017e+00
  1.35088813e+00]
 [1.04486990e+00 1.56117499e+00 1.72049940e+00 1.55115056e+00
  1.81983054e+00 1.50904894e+00 1.27416563e+00 0.00000000e+00
  1.73059404e+00 1.20836592e+00 1.79410470e+00 6.68986320e-01
  1.05799127e+00 1.37805092e+00 1.73939395e+00 1.00934064e+00
  1.03433597e+00]
 [1.35072482e+00 1.31897092e+00 1.43183935e+00 1.38883734e+00
  9.79789555e-01 1.48072851e+00 1.67132044e+00 1.73059404e+00
  0.00000000e+00 1.72134233e+00 1.72799480e+00 1.81227207e+00
  1.72495472e+00 1.56339538e+00 1.59697795e+00 1.68999910e+00
  2.08204961e+00]
 [8.27648938e-01 1.46207821e+00 1.46739113e+00 1.32914245e+00
  1.56632650e+00 1.49227881e+00 1.33244336e+00 1.20836592e+00
  1.72134233e+00 1.09183008e-03 1.09582484e+00 1.28317952e+00
  1.49518263e+00 1.22296464e+00 1.53098869e+00 1.43846107e+00
  9.38737094e-01]
 [1.38940430e+00 1.43353999e+00 1.17808318e+00 1.25670063e+00
  1.38577926e+00 1.47026372e+00 1.36388493e+00 1.79410470e+00
  1.72799480e+00 1.09582484e+00 0.00000000e+00 1.81130123e+00
  1.89112878e+00 1.57545674e+00 1.39604163e+00 1.80129862e+00
  1.47700918e+00]
 [1.25898850e+00 1.64951026e+00 1.69609964e+00 1.71072912e+00
  1.76606607e+00 1.45428777e+00 1.43582797e+00 6.68986320e-01
  1.81227207e+00 1.28317952e+00 1.81130123e+00 0.00000000e+00
  9.51204002e-01 1.57533872e+00 1.92373621e+00 1.33710527e+00
  9.23144758e-01]
 [1.29147112e+00 1.70039773e+00 1.80019069e+00 1.75486076e+00
  1.80165470e+00 1.72079515e+00 1.66474628e+00 1.05799127e+00
  1.72495425e+00 1.49518263e+00 1.89112878e+00 9.51203346e-01
  0.00000000e+00 1.12051928e+00 1.65307224e+00 8.83095503e-01
  1.42351651e+00]
 [8.71032000e-01 1.29005814e+00 1.45066500e+00 1.25879478e+00
  1.75867343e+00 1.90232337e+00 1.70392013e+00 1.37805045e+00
  1.56339538e+00 1.22296429e+00 1.57545698e+00 1.57533872e+00
  1.12051880e+00 0.00000000e+00 9.45833027e-01 9.33270752e-01
  1.69597054e+00]
 [1.26768816e+00 8.58871996e-01 1.05815685e+00 7.95539618e-01
  1.74491632e+00 1.93198276e+00 1.82027757e+00 1.73939359e+00
  1.59697795e+00 1.53098834e+00 1.39604163e+00 1.92373621e+00
  1.65307260e+00 9.45833027e-01 0.00000000e+00 1.43220723e+00
  1.91783667e+00]
 [1.16353226e+00 1.70099866e+00 1.82808816e+00 1.61796260e+00
  1.92834961e+00 1.76829147e+00 1.52197969e+00 1.00934064e+00
  1.68999887e+00 1.43846107e+00 1.80129862e+00 1.33710527e+00
  8.83095503e-01 9.33270752e-01 1.43220723e+00 0.00000000e+00
  1.54103947e+00]
 [1.40258491e+00 1.73840749e+00 1.73901689e+00 1.70377111e+00
  1.96058857e+00 1.51956201e+00 1.35088813e+00 1.03433597e+00
  2.08204961e+00 9.38737690e-01 1.47700918e+00 9.23144102e-01
  1.42351651e+00 1.69597054e+00 1.91783667e+00 1.54103947e+00
  0.00000000e+00]]
RMSD between GaMD - GaMD
[[1.18969905 1.29972589 1.00273824 0.1968143  1.29032087 0.87240845
  1.40313756 1.63978922 1.45187616 1.36142492 1.77287316 1.49259281
  1.46435332 1.04547906]
 [0.21178408 0.6967895  0.63821554 1.1466285  1.31935132 1.49283195
  1.37622046 1.50320697 1.79498625 1.78295493 1.72703087 1.91355014
  1.58647609 1.68375731]
 [0.70834959 0.22421362 0.93765825 1.33934093 1.4938035  1.4935298
  1.12488604 1.24287438 1.72599506 1.75536799 1.64199483 1.89212799
  1.66340256 1.77188015]
 [0.58161551 0.89923728 0.43381941 1.00646484 1.39761925 1.3146354
  1.2016834  1.38996267 1.75805283 1.74824429 1.73950183 1.91428077
  1.58462048 1.6241796 ]
 [1.44122267 1.36738014 1.27923667 1.48678315 1.00274229 1.46811891
  1.28418708 1.5024966  1.88583684 1.89214337 1.42270982 1.58624911
  1.0698837  1.80795193]
 [1.70149267 1.60691452 1.56814277 1.57401991 1.48846793 1.38607609
  1.4058311  1.63218558 1.36707199 1.34642076 1.38319957 1.24005556
  1.23983788 1.45673382]
 [1.67966616 1.71683145 1.60963464 1.36181414 1.65477288 1.25283062
  1.32433534 1.55945969 1.233724   1.20180583 1.61923003 1.3588078
  1.43311965 1.19553792]
 [1.50421572 1.66940856 1.47490966 1.00079429 1.63549912 1.25777411
  1.855775   2.07829881 1.15403497 0.96203363 1.73486018 1.17335367
  1.43897605 0.3216399 ]
 [1.30674183 1.45498347 1.23390269 1.37465131 0.26699209 1.68441391
  1.60483122 1.79533958 2.06949592 1.96861601 1.55393386 1.5692687
  0.83757389 1.72445047]
 [1.43392205 1.38961697 1.32899892 0.85283947 1.66392684 0.2932514
  1.18865597 1.44248188 0.98855013 0.93093222 1.68472397 1.34629953
  1.71530497 1.17118049]
 [1.41935468 1.15222275 1.34253049 1.43894553 1.76885366 1.04237461
  0.31205529 0.69692636 1.40933442 1.48094702 1.59840596 1.73301673
  1.7679069  1.72564018]
 [1.6137104  1.61126673 1.57438493 1.21386218 1.7259655  1.32785797
  1.90590632 2.1153152  0.98954082 1.04167914 1.68485546 1.18739915
  1.47884667 0.77673942]
 [1.73126149 1.72920239 1.62486804 1.28035498 1.625368   1.55528045
  1.99892867 2.22900224 1.47004724 1.46898413 1.84917521 1.45617056
  1.48791289 1.10422683]
 [1.34474409 1.41529441 1.27903092 0.86557478 1.48907769 1.31589043
  1.63231003 1.84173417 1.76408148 1.65604711 2.06667924 1.78726578
  1.70603263 1.39261079]
 [0.93050188 1.08065748 0.92622721 1.25157726 1.59659529 1.57455182
  1.38745439 1.53614938 1.97259486 1.89125919 1.97134387 2.06042123
  1.83396935 1.7780087 ]
 [1.70239878 1.80181038 1.57054925 1.17826426 1.61686766 1.4977628
  1.85671663 2.08898091 1.62385714 1.40142548 1.88031268 1.44702256
  1.48406172 0.94408208]
 [1.69554567 1.67813361 1.7086457  1.36617255 2.02020454 1.00424099
  1.60297894 1.77622306 0.36915159 0.54763526 1.72044289 1.29326439
  1.8107866  1.04397392]]
RMSD between GaMD - GaMD
[[1.14480245]
 [0.47788742]
 [0.71971148]
 [0.73040003]
 [1.34663641]
 [1.61820638]
 [1.7223345 ]
 [1.46080005]
 [1.34824133]
 [1.30581236]
 [1.39814925]
 [1.44709539]
 [1.60406232]
 [1.34825099]
 [1.06340945]
 [1.7064302 ]
 [1.59067464]]
RMSD between GaMD - GaMD
[[0.00000000e+00 7.36356616e-01 6.27364457e-01 1.12534785e+00
  1.30496120e+00 1.45267904e+00 1.34166014e+00 1.47952890e+00
  1.73892546e+00 1.70840013e+00 1.68241155e+00 1.84679246e+00
  1.56730413e+00 1.62156725e+00]
 [7.36356616e-01 0.00000000e+00 8.81846607e-01 1.28272748e+00
  1.50179029e+00 1.41616678e+00 1.13074124e+00 1.28151774e+00
  1.67440963e+00 1.71192276e+00 1.62474585e+00 1.85048342e+00
  1.65603268e+00 1.72476602e+00]
 [6.27363563e-01 8.81846607e-01 0.00000000e+00 9.79364872e-01
  1.22478032e+00 1.28630745e+00 1.28525794e+00 1.52354383e+00
  1.73945558e+00 1.69707763e+00 1.63388789e+00 1.77911496e+00
  1.42125833e+00 1.55706871e+00]
 [1.12534785e+00 1.28272748e+00 9.79364872e-01 0.00000000e+00
  1.29792798e+00 9.12890077e-01 1.45734084e+00 1.68126607e+00
  1.43672681e+00 1.35347915e+00 1.83257842e+00 1.53050971e+00
  1.47752929e+00 1.03473175e+00]
 [1.30496120e+00 1.50179029e+00 1.22478032e+00 1.29792798e+00
  0.00000000e+00 1.62872612e+00 1.66041982e+00 1.86524415e+00
  2.02120876e+00 1.91209459e+00 1.61081195e+00 1.52585149e+00
  8.16939175e-01 1.64524889e+00]
 [1.45267904e+00 1.41616678e+00 1.28630745e+00 9.12890077e-01
  1.62872612e+00 0.00000000e+00 1.11382341e+00 1.42424822e+00
  9.96356964e-01 9.57619011e-01 1.64856029e+00 1.35441852e+00
  1.64769936e+00 1.21772337e+00]
 [1.34166014e+00 1.13074124e+00 1.28525794e+00 1.45734048e+00
  1.66041946e+00 1.11382341e+00 0.00000000e+00 6.11336112e-01
  1.52059507e+00 1.55848598e+00 1.54455650e+00 1.74207568e+00
  1.70387566e+00 1.78800726e+00]
 [1.47952890e+00 1.28151751e+00 1.52354383e+00 1.68126607e+00
  1.86524415e+00 1.42424822e+00 6.11336112e-01 0.00000000e+00
  1.72553480e+00 1.76806700e+00 1.53698611e+00 1.86919165e+00
  1.90645218e+00 2.01569629e+00]
 [1.73892546e+00 1.67440963e+00 1.73945558e+00 1.43672681e+00
  2.02120876e+00 9.96356964e-01 1.52059507e+00 1.72553480e+00
  0.00000000e+00 5.68054974e-01 1.65429401e+00 1.29109633e+00
  1.80766869e+00 1.13559616e+00]
 [1.70839977e+00 1.71192276e+00 1.69707799e+00 1.35347915e+00
  1.91209459e+00 9.57619011e-01 1.55848598e+00 1.76806700e+00
  5.68054974e-01 0.00000000e+00 1.63512337e+00 1.07467914e+00
  1.72873902e+00 8.90752017e-01]
 [1.68241155e+00 1.62474585e+00 1.63388789e+00 1.83257842e+00
  1.61081195e+00 1.64856029e+00 1.54455602e+00 1.53698611e+00
  1.65429401e+00 1.63512337e+00 1.09183008e-03 1.08515382e+00
  1.32334399e+00 1.68875265e+00]
 [1.84679246e+00 1.85048342e+00 1.77911496e+00 1.53050971e+00
  1.52585149e+00 1.35441852e+00 1.74207568e+00 1.86919212e+00
  1.29109573e+00 1.07467914e+00 1.08515334e+00 0.00000000e+00
  1.24572444e+00 1.07741892e+00]
 [1.56730413e+00 1.65603268e+00 1.42125833e+00 1.47752929e+00
  8.16939175e-01 1.64769936e+00 1.70387566e+00 1.90645218e+00
  1.80766869e+00 1.72873902e+00 1.32334399e+00 1.24572504e+00
  0.00000000e+00 1.42507005e+00]
 [1.62156725e+00 1.72476602e+00 1.55706871e+00 1.03473175e+00
  1.64524889e+00 1.21772337e+00 1.78800726e+00 2.01569629e+00
  1.13559616e+00 8.90752017e-01 1.68875229e+00 1.07741892e+00
  1.42507005e+00 0.00000000e+00]]
RMSD between GaMD - GaMD
[[0.50336802]
 [0.62971342]
 [0.56226492]
 [1.08862305]
 [1.32273805]
 [1.32247353]
 [1.3692795 ]
 [1.56050205]
 [1.63240683]
 [1.62743199]
 [1.61497951]
 [1.7464596 ]
 [1.54259062]
 [1.58846486]]
RMSD between GaMD - GaMD
[[0.]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NOE</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">noe</span><span class="o">.</span><span class="n">read_NOE</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">noe</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOE_dist = {}</span>
<span class="c1"># NOE_store = {}</span>
<span class="c1"># NOE_dist_cis={}</span>
<span class="c1"># NOE_dist_trans={}</span>
<span class="c1"># NOE_store_cis = {}</span>
<span class="c1"># NOE_store_trans = {}</span>
<span class="c1"># for i in range(3):</span>
<span class="c1">#     NOE_output = {}</span>
<span class="c1">#     if methods[i] != &quot;cMD&quot;:</span>
<span class="c1">#         if multiple:</span>
<span class="c1">#             fig, axs = plt.subplots(2,1)</span>
<span class="c1">#             fig.set_size_inches(10,6)</span>
<span class="c1">#             NOE_trans, NOE_cis = NOE</span>
<span class="c1">#             NOE_cis_dict = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             NOE_trans_dict = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             if len(cis[i]) &gt; 0:</span>
<span class="c1">#                 NOE_cis[&#39;md&#39;],NOE_cis[&#39;lower&#39;],NOE_cis[&#39;upper&#39;],NOE_dist_cis[i], pmf_plot_cis = compute_NOE_mdtraj(NOE_cis_dict, trajs[i][cis[i]], snakemake.input[f&quot;weights_{i}&quot;], 1, weight_data=weight_data[i][cis[i]])</span>
<span class="c1">#                 NOE_output[f&quot;{multi[&#39;cis&#39;]}&quot;] = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#                 # Deal with ambigous NOEs</span>
<span class="c1">#                 NOE_cis = NOE_cis.explode([&#39;md&#39;, &#39;lower&#39;, &#39;upper&#39;])</span>
<span class="c1">#                 # and ambigous/multiple values</span>
<span class="c1">#                 NOE_cis = NOE_cis.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#                 fig, axs[1] = plot_NOE(NOE_cis, fig, axs[1])</span>
<span class="c1">#                 axs[1].set_title(f&quot;Compound {multi[&#39;cis&#39;]} (cis)&quot;)</span>
<span class="c1">#                 NOE_store_cis[i] = NOE_cis</span>
<span class="c1">#             else:</span>
<span class="c1">#                 print(&quot;Cis skipped because no frames are cis.&quot;)</span>
<span class="c1">#             if len(trans[i]) &gt; 0:</span>
<span class="c1">#                 NOE_trans[&#39;md&#39;],NOE_trans[&#39;lower&#39;],NOE_trans[&#39;upper&#39;],NOE_dist_trans[i], pmf_plot_trans = compute_NOE_mdtraj(NOE_trans_dict, trajs[i][trans[i]], snakemake.input[f&quot;weights_{i}&quot;], 1, weight_data=weight_data[i][trans[i]])</span>
<span class="c1">#                 NOE_output[f&quot;{multi[&#39;trans&#39;]}&quot;] = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#                 # Deal with ambigous NOEs</span>
<span class="c1">#                 NOE_trans = NOE_trans.explode([&#39;md&#39;, &#39;lower&#39;, &#39;upper&#39;])</span>
<span class="c1">#                 # and ambigous/multiple values</span>
<span class="c1">#                 NOE_trans = NOE_trans.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#                 fig, axs[0] = plot_NOE(NOE_trans, fig, axs[0])</span>
<span class="c1">#                 axs[0].set_title(f&quot;Compound {multi[&#39;trans&#39;]} (trans)&quot;)</span>
<span class="c1">#                 NOE_store_trans[i] = NOE_trans</span>
<span class="c1">#             else:</span>
<span class="c1">#                 print(&quot;Trans skipped because no frames are cis&quot;)</span>
<span class="c1">#             #NOE_output = {f&quot;{multi[cis]}&quot;: NOE_cis, f&quot;{multi[trans]}&quot;: NOE_trans}</span>
<span class="c1">#             #src.utils.json_dump(snakemake.output.noe_result, NOE_output)</span>
<span class="c1">#         else:</span>
<span class="c1">#             NOE = src.noe.read_NOE(snakemake.input.noe)</span>
<span class="c1">#             NOE_dict = NOE.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             NOE[&#39;md&#39;], NOE[&#39;lower&#39;], NOE[&#39;upper&#39;], NOE_dist[i], pmf_plot = src.noe.compute_NOE_mdtraj(NOE_dict, trajs[i], snakemake.input[f&quot;weights_{i}&quot;], 1, weight_data=weight_data[i])</span>
<span class="c1">#             plt.close()</span>
<span class="c1">#             # Save NOE dict</span>
<span class="c1">#             NOE_output = {f&quot;{compound_index}&quot;: NOE.to_dict(orient=&#39;index&#39;)}</span>
<span class="c1">#             # save as .json file</span>
<span class="c1">#             #src.utils.json_dump(snakemake.output.noe_result, NOE_output)</span>
<span class="c1">#             # Deal with ambigous NOEs</span>
<span class="c1">#             #NOE = NOE.explode(&#39;md&#39;)</span>
<span class="c1">#             NOE = NOE.explode([&#39;md&#39;, &#39;lower&#39;, &#39;upper&#39;])</span>
<span class="c1">#             # and ambigous/multiple values</span>
<span class="c1">#             NOE = NOE.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#             fig, ax = plot_NOE(NOE)</span>
<span class="c1">#             ax.set_title(f&quot;Compound {compound_index}. NOE&quot;)</span>
<span class="c1">#             fig.tight_layout()</span>
<span class="c1">#             #fig.savefig(snakemake.output.noe_plot)</span>
<span class="c1">#             NOE_store[i] = NOE</span>
<span class="c1">#     else:</span>
<span class="c1">#         print(&quot;cMD - no reweighted NOEs performed.&quot;)</span>
<span class="c1">#         if multiple:</span>
<span class="c1">#             fig, axs = plt.subplots(2,1)</span>
<span class="c1">#             fig.set_size_inches(10,6)</span>
<span class="c1">#             NOE_trans, NOE_cis = NOE</span>
<span class="c1">#             NOE_cis_dict = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             NOE_trans_dict = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             if len(cis[i]) &gt; 0:</span>
<span class="c1">#                 NOE_cis[&#39;md&#39;],_,_2,NOE_dist_cis, pmf_plot_cis = compute_NOE_mdtraj(NOE_cis_dict, t[cis[i]], snakemake.input.weights, 1, cis[i])</span>
<span class="c1">#                 NOE_output[f&quot;{multi[&#39;cis&#39;]}&quot;] = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#                 # Deal with ambigous NOEs</span>
<span class="c1">#                 NOE_cis = NOE_cis.explode(&#39;md&#39;)</span>
<span class="c1">#                 # and ambigous/multiple values</span>
<span class="c1">#                 NOE_cis = NOE_cis.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#                 fig, axs[1] = plot_NOE(NOE_cis, fig, axs[1])</span>
<span class="c1">#                 axs[1].set_title(f&quot;Compound {multi[&#39;cis&#39;]} (cis)&quot;)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 print(&quot;Cis skipped because no frames are cis.&quot;)</span>
<span class="c1">#             if len(trans[i]) &gt; 0:</span>
<span class="c1">#                 NOE_trans[&#39;md&#39;],_,_2,NOE_dist_trans, pmf_plot_trans = compute_NOE_mdtraj(NOE_trans_dict, t[trans[i]], snakemake.input.weights, 1, trans[i])</span>
<span class="c1">#                 NOE_output[f&quot;{multi[&#39;trans&#39;]}&quot;] = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#                 # Deal with ambigous NOEs</span>
<span class="c1">#                 NOE_trans = NOE_trans.explode(&#39;md&#39;)</span>
<span class="c1">#                 # and ambigous/multiple values</span>
<span class="c1">#                 NOE_trans = NOE_trans.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#                 fig, axs[0] = plot_NOE(NOE_trans, fig, axs[0])</span>
<span class="c1">#                 axs[0].set_title(f&quot;Compound {multi[&#39;trans&#39;]} (trans)&quot;)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 print(&quot;Trans skipped because no frames are cis&quot;)</span>
<span class="c1">#             #NOE_output = {f&quot;{multi[cis]}&quot;: NOE_cis, f&quot;{multi[trans]}&quot;: NOE_trans}</span>
<span class="c1">#             src.utils.json_dump(snakemake.output.noe_result, NOE_output)</span>
<span class="c1">#         else:</span>
<span class="c1">#             NOE = src.noe.read_NOE(snakemake.input.noe)</span>
<span class="c1">#             NOE_dict = NOE.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             NOE[&#39;md&#39;], NOE[&#39;lower&#39;], NOE[&#39;upper&#39;], NOE_dist[i], pmf_plot = src.noe.compute_NOE_mdtraj(NOE_dict, trajs[i])</span>
<span class="c1">#             plt.close()</span>
<span class="c1">#             # Save NOE dict</span>
<span class="c1">#             NOE_output = {f&quot;{compound_index}&quot;: NOE.to_dict(orient=&#39;index&#39;)}</span>
<span class="c1">#             # save as .json file</span>
<span class="c1">#             #src.utils.json_dump(snakemake.output.noe_result, NOE_output)</span>
<span class="c1">#             # Deal with ambigous NOEs</span>
<span class="c1">#             #NOE = NOE.explode(&#39;md&#39;)</span>
<span class="c1">#             NOE = NOE.explode([&#39;md&#39;, &#39;lower&#39;, &#39;upper&#39;])</span>
<span class="c1">#             # and ambigous/multiple values</span>
<span class="c1">#             NOE = NOE.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#             fig, ax = plot_NOE(NOE)</span>
<span class="c1">#             ax.set_title(f&quot;Compound {compound_index}. NOE&quot;)</span>
<span class="c1">#             fig.tight_layout()</span>
<span class="c1">#             #fig.savefig(snakemake.output.noe_plot)</span>
<span class="c1">#             NOE_store[i] = NOE</span>
<span class="c1">#     print(f&quot;Done {i}&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NOE</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">noe</span><span class="o">.</span><span class="n">read_NOE</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">noe</span><span class="p">)</span>
<span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
<span class="n">NOE_dist</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">NOE_store</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">NOE_dist_cis</span><span class="o">=</span><span class="p">{}</span>
<span class="n">NOE_dist_trans</span><span class="o">=</span><span class="p">{}</span>
<span class="n">NOE_store_cis</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">NOE_store_trans</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">NOE_output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;cMD&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">NOE_dist_cis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;NOE_dist_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])[</span><span class="n">cis</span><span class="p">]</span>
                <span class="c1">#NOE_store_cis[i] = NOE_cis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cis skipped because no frames are cis.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">NOE_dist_trans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;NOE_dist_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])[</span><span class="n">trans</span><span class="p">]</span>
                <span class="c1">#NOE_store_trans[i] = NOE_trans</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trans skipped because no frames are cis&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NOE_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">pickle_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;NOE_dist_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
<span class="c1">#     </span>
<span class="c1">#     print(f&quot;Done {i}&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # plot PCA, colored by NOE</span>
<span class="c1"># NOE_select = 11</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting color deviation would be better maybe?</span>
<span class="c1"># activate below for plotting pca, colored by NOE value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if not multiple:</span>
<span class="c1">#     for NOE_select in range(len(NOE_dist[0])):</span>
<span class="c1">#         if np.all(~np.isnan(NOE_dist[0][NOE_select][0])):</span>
<span class="c1">#             zs = np.concatenate([NOE_dist[0][NOE_select][0], NOE_dist[1][NOE_select][0], NOE_dist[2][NOE_select][0]], axis=0)</span>
<span class="c1">#         else:</span>
<span class="c1">#             zs=np.array([0,0])</span>
<span class="c1">#             min_, max_ = zs.min(), zs.max()</span>
<span class="c1">#             continue</span>
<span class="c1">#         # Plot re-weighted PCA plots</span>
<span class="c1">#         for a in range(len(NOE_dist[1][NOE_select])):</span>
<span class="c1">#             # here we select NOE_store[1], but 0, 2 could be used too (exp value is the same)</span>
<span class="c1">#             NOE_exp = NOE[NOE.index == str(NOE_select)][&#39;NMR exp&#39;][0]</span>
<span class="c1">#             #NOE_md = NOE_store[a][NOE_store[a].index == str(NOE_select)][&#39;md&#39;][a]</span>
<span class="c1">#             fig, axs = plt.subplots(1,4, sharex=&#39;all&#39;, sharey=&#39;all&#39;)</span>
<span class="c1">#             fig.set_size_inches(16,4)</span>
<span class="c1">#             fig.suptitle(f&quot;Compound {compound_index}. NOE #{NOE_select} (amb # {a}). exp={NOE_exp}.&quot;)</span>

<span class="c1">#             for i in range(3):</span>
<span class="c1">#                 scat = axs[i].scatter(dihe[i][:,0], dihe[i][:,1], c=NOE_dist[i][NOE_select][a], marker=&#39;.&#39;, s=0.5, vmin=0, vmax=8)</span>
<span class="c1">#                 axs[i].set_title(f&quot;{methods[i]}: {simtime[i]} ns (r# {repeats[i]})&quot;)</span>
<span class="c1">#                 axs[3].scatter(dihe[i][:,0], dihe[i][:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, label=methods[i])</span>

<span class="c1">#             lgnd = axs[3].legend()</span>
<span class="c1">#             for handle in lgnd.legendHandles:</span>
<span class="c1">#                 handle.set_sizes([30.0])</span>
<span class="c1">#                 handle.set_alpha(1)</span>

<span class="c1">#             axs[3].set_title(&#39;Overlay&#39;)</span>

<span class="c1">#             colorbar = fig.colorbar(scat, ax=axs, label=&quot;NOE [A]&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if not multiple:</span>
<span class="c1">#     for NOE_select in range(len(NOE_dist[0])):</span>
<span class="c1">#         if np.all(~np.isnan(NOE_dist[0][NOE_select][0])):</span>
<span class="c1">#             zs = np.concatenate([NOE_dist[0][NOE_select][0], NOE_dist[1][NOE_select][0], NOE_dist[2][NOE_select][0]], axis=0)</span>
<span class="c1">#         else:</span>
<span class="c1">#             zs=np.array([0,0])</span>
<span class="c1">#             min_, max_ = zs.min(), zs.max()</span>
<span class="c1">#             continue</span>
<span class="c1">#         # Plot re-weighted PCA plots</span>
<span class="c1">#         for a in range(len(NOE_dist[1][NOE_select])):</span>
<span class="c1">#             # here we select NOE_store[1], but 0, 2 could be used too (exp value is the same)</span>
<span class="c1">#             NOE_exp = NOE_store[1][NOE_store[1].index == str(NOE_select)][&#39;NMR exp&#39;][a]</span>
<span class="c1">#             #NOE_md = NOE_store[a][NOE_store[a].index == str(NOE_select)][&#39;md&#39;][a]</span>
<span class="c1">#             fig, axs = plt.subplots(1,4, sharex=&#39;all&#39;, sharey=&#39;all&#39;)</span>
<span class="c1">#             fig.set_size_inches(16,4)</span>
<span class="c1">#             fig.suptitle(f&quot;Compound {compound_index}. NOE #{NOE_select} (amb # {a}). exp={NOE_exp}.&quot;)</span>

<span class="c1">#             for i in range(3):</span>
<span class="c1">#                 scat = axs[i].scatter(dihe[i][:,0], dihe[i][:,1], c=NOE_dist[i][NOE_select][a], marker=&#39;.&#39;, s=0.5, vmin=0, vmax=8)</span>
<span class="c1">#                 axs[i].set_title(f&quot;{methods[i]}: {simtime[i]} ns (r# {repeats[i]})&quot;)</span>
<span class="c1">#                 axs[3].scatter(dihe[i][:,0], dihe[i][:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, label=methods[i])</span>

<span class="c1">#             lgnd = axs[3].legend()</span>
<span class="c1">#             for handle in lgnd.legendHandles:</span>
<span class="c1">#                 handle.set_sizes([30.0])</span>
<span class="c1">#                 handle.set_alpha(1)</span>

<span class="c1">#             axs[3].set_title(&#39;Overlay&#39;)</span>

<span class="c1">#             colorbar = fig.colorbar(scat, ax=axs, label=&quot;NOE [A]&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if not multiple:</span>
<span class="c1">#     zs = np.concatenate([weights[0], weights[1], weights[2]], axis=0)</span>
<span class="c1">#     min_, max_ = zs.min(), zs.max()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if not multiple:</span>
<span class="c1">#     # Plot NOE-PCA plots</span>
<span class="c1">#     for a in range(len(NOE_dist[1][NOE_select])):</span>
<span class="c1">#         NOE_exp = NOE_store[a][NOE_store[a].index == str(NOE_select)][&#39;NMR exp&#39;][a]</span>
<span class="c1">#         NOE_md = NOE_store[a][NOE_store[a].index == str(NOE_select)][&#39;md&#39;][a]</span>
<span class="c1">#         fig, axs = plt.subplots(1,4, sharex=&#39;all&#39;, sharey=&#39;all&#39;)</span>
<span class="c1">#         fig.set_size_inches(16,4)</span>
<span class="c1">#         fig.suptitle(f&quot;Compound {compound_index}. NOE #{NOE_select}. ambiguous NOE# {a}. exp={NOE_exp}. md={NOE_md}&quot;)</span>

<span class="c1">#         for i in range(3):</span>
<span class="c1">#             scat = axs[i].scatter(dihe[i][:,0], NOE_dist[i][NOE_select][a], c=weights[i], cmap=&#39;Spectral_r&#39;, marker=&#39;.&#39;, s=0.5, vmin=min_, vmax=max_)</span>
<span class="c1">#             axs[i].set_title(f&quot;{methods[i]}: {simtime[i]} ns (r# {repeats[i]})&quot;)</span>
<span class="c1">#             axs[3].scatter(dihe[i][:,0], dihe[i][:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, label=methods[i])</span>

<span class="c1">#         lgnd = axs[3].legend()</span>
<span class="c1">#         for handle in lgnd.legendHandles:</span>
<span class="c1">#             handle.set_sizes([30.0])</span>
<span class="c1">#             handle.set_alpha(1)</span>

<span class="c1">#         axs[3].set_title(&#39;Overlay&#39;)</span>

<span class="c1">#         colorbar = fig.colorbar(scat, ax=axs, label=&quot;kcal/mol&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># THIS WAS THE END OF THE SCRIPT. BELOW IS OLD.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # 1d PMF reweighted NOEs</span>
<span class="c1"># NOE_output = {}</span>
<span class="c1"># if snakemake.params.method != &quot;cMD&quot;:</span>
<span class="c1">#     if multiple:</span>
<span class="c1">#         fig, axs = plt.subplots(2,1)</span>
<span class="c1">#         fig.set_size_inches(10,6)</span>
<span class="c1">#         NOE_trans, NOE_cis = NOE</span>
<span class="c1">#         NOE_cis_dict = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#         NOE_trans_dict = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#         if len(cis) &gt; 0:</span>
<span class="c1">#             NOE_cis[&#39;md&#39;],_,_2,NOE_dist_cis, pmf_plot_cis = compute_NOE_mdtraj(NOE_cis_dict, t[cis], snakemake.input.weights, 1, cis)</span>
<span class="c1">#             NOE_output[f&quot;{multi[&#39;cis&#39;]}&quot;] = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             # Deal with ambigous NOEs</span>
<span class="c1">#             NOE_cis = NOE_cis.explode(&#39;md&#39;)</span>
<span class="c1">#             # and ambigous/multiple values</span>
<span class="c1">#             NOE_cis = NOE_cis.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#             fig, axs[1] = plot_NOE(NOE_cis, fig, axs[1])</span>
<span class="c1">#             axs[1].set_title(f&quot;Compound {multi[&#39;cis&#39;]} (cis)&quot;)</span>
<span class="c1">#         else:</span>
<span class="c1">#             print(&quot;Cis skipped because no frames are cis.&quot;)</span>
<span class="c1">#         if len(trans) &gt; 0:</span>
<span class="c1">#             NOE_trans[&#39;md&#39;],_,_2,NOE_dist_trans, pmf_plot_trans = compute_NOE_mdtraj(NOE_trans_dict, t[trans], snakemake.input.weights, 1, trans)</span>
<span class="c1">#             NOE_output[f&quot;{multi[&#39;trans&#39;]}&quot;] = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#             # Deal with ambigous NOEs</span>
<span class="c1">#             NOE_trans = NOE_trans.explode(&#39;md&#39;)</span>
<span class="c1">#             # and ambigous/multiple values</span>
<span class="c1">#             NOE_trans = NOE_trans.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#             fig, axs[0] = plot_NOE(NOE_trans, fig, axs[0])</span>
<span class="c1">#             axs[0].set_title(f&quot;Compound {multi[&#39;trans&#39;]} (trans)&quot;)</span>
<span class="c1">#         else:</span>
<span class="c1">#             print(&quot;Trans skipped because no frames are cis&quot;)</span>
<span class="c1">#         #NOE_output = {f&quot;{multi[cis]}&quot;: NOE_cis, f&quot;{multi[trans]}&quot;: NOE_trans}</span>
<span class="c1">#         src.utils.json_dump(snakemake.output.noe_result, NOE_output)</span>
<span class="c1">#     else:</span>
<span class="c1">#         NOE = src.noe.read_NOE(NOE_path)</span>
<span class="c1">#         NOE_dict = NOE.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#         NOE[&#39;md&#39;], NOE[&#39;lower&#39;], NOE[&#39;upper&#39;], _, pmf_plot = src.noe.compute_NOE_mdtraj(NOE_dict, t, snakemake.input.weights, 1)</span>
<span class="c1">#         plt.close()</span>
<span class="c1">#         # Save NOE dict</span>
<span class="c1">#         NOE_output = {f&quot;{compound_index}&quot;: NOE.to_dict(orient=&#39;index&#39;)}</span>
<span class="c1">#         # save as .json file</span>
<span class="c1">#         src.utils.json_dump(snakemake.output.noe_result, NOE_output)</span>
<span class="c1">#         # Deal with ambigous NOEs</span>
<span class="c1">#         #NOE = NOE.explode(&#39;md&#39;)</span>
<span class="c1">#         NOE = NOE.explode([&#39;md&#39;, &#39;lower&#39;, &#39;upper&#39;])</span>
<span class="c1">#         # and ambigous/multiple values</span>
<span class="c1">#         NOE = NOE.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#         fig, ax = plot_NOE(NOE)</span>
<span class="c1">#         ax.set_title(f&quot;Compound {compound_index}. NOE&quot;)</span>
<span class="c1">#         fig.tight_layout()</span>
<span class="c1">#         fig.savefig(snakemake.output.noe_plot)</span>
<span class="c1"># else:</span>
<span class="c1">#     print(&quot;cMD - no reweighted NOEs performed.&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load GaMD</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># trajectory reference:</span>
<span class="c1"># t_x: production trajectory of method x</span>
<span class="c1"># t_x_full: full trajectory of method x (equilibration &amp; production)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_g = md.load(snakemake.input.ga_traj, top=snakemake.input.top)</span>
<span class="c1"># print(t_g)</span>
<span class="c1"># # Remove solvent from trajectory</span>
<span class="c1"># t_g = t_g.restrict_atoms(t_g.topology.select(&#39;protein&#39;))</span>
<span class="c1"># t_g</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_g_full = t_g</span>
<span class="c1"># t_g = t_g[-50000:]</span>
<span class="c1"># t_g</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if has_cis_trans:</span>
<span class="c1">#     # split trajectory into 2 by defined feature</span>
    
<span class="c1">#     t_g_cis</span>
<span class="c1">#     t_g_trans</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load aMD</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_a = md.load(snakemake.input.a_traj, top=snakemake.input.top)</span>
<span class="c1"># print(t_a)</span>
<span class="c1"># # Remove solvent from trajectory</span>
<span class="c1"># t_a = t_a.restrict_atoms(t_a.topology.select(&#39;protein&#39;))</span>
<span class="c1"># t_a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_c = md.load(snakemake.input.c_traj, top=snakemake.input.top)</span>
<span class="c1"># print(t_c)</span>
<span class="c1"># # Remove solvent from trajectory</span>
<span class="c1"># t_c = t_c.restrict_atoms(t_c.topology.select(&#39;protein&#39;))</span>
<span class="c1"># t_c</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_g.superpose(t_g, 0)</span>
<span class="c1"># t_a.superpose(t_a, 0)</span>
<span class="c1"># t_c.superpose(t_c, 0)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if multiple:</span>
<span class="c1">#     ca_c = t_g.top.select(f&quot;resid 0 and name CA C&quot;)</span>
<span class="c1">#     n_ca_next = t_g.top.select(f&quot;resid 1 and name N CA&quot;)</span>

<span class="c1">#     omega = np.append(ca_c, n_ca_next)</span>
<span class="c1">#     t_omega_rad = md.compute_dihedrals(t_a, [omega])</span>
<span class="c1">#     t_omega_deg = np.abs(np.degrees(t_omega_rad))</span>
<span class="c1">#     plt.plot(t_omega_deg)</span>
<span class="c1">#     plt.hlines(90, 0, 50000, color=&#39;red&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if multiple:</span>
<span class="c1">#     cis = np.where(t_omega_deg &lt;= 90)[0]</span>
<span class="c1">#     trans = np.where(t_omega_deg &gt; 90)[0]</span>

<span class="c1">#     t_a[trans]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># omega = getOmega(t_c)</span>
<span class="c1"># omega_deg = np.abs(np.degrees(omega))</span>
<span class="c1"># plt.plot(omega_deg)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Principle Component Analysis (PCA)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dihedral variable reference:</span>
<span class="c1"># x_dihe: (reduced) dihedral angles of method x (via PCA)</span>
<span class="c1"># x_dihe_all: full dihedral angles of method x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># g_dihe_all = getDih(t_g)</span>
<span class="c1"># a_dihe_all = getDih(t_a)</span>
<span class="c1"># c_dihe_all = getDih(t_c)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pca4 = PCA(n_components=2)</span>
<span class="c1"># g_dihe = pca4.fit_transform(g_dihe_all)</span>
<span class="c1"># g_dihe.shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now apply the same transformation to a_dihe, c_dihe</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a_dihe = pca4.transform(a_dihe_all)</span>
<span class="c1"># c_dihe = pca4.transform(c_dihe_all)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt.scatter(g_dihe[:,0], g_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=1)</span>
<span class="c1"># plt.scatter(c_dihe[:,0], c_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.02)</span>
<span class="c1"># plt.scatter(a_dihe[:,0], a_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.02)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># How much of the variance is explained by the 2 components?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(f&quot;The two components explain {sum(pca4.explained_variance_ratio_):.2%} of the variance&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># g_weights = src.reweight(g_dihe, snakemake.input.ga_weights, &#39;amdweight_MC&#39;)</span>
<span class="c1"># a_weights = src.reweight(a_dihe, snakemake.input.a_weights, &#39;amdweight_MC&#39;)</span>
<span class="c1"># c_weights = src.reweight(c_dihe, None, &#39;noweight&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Plot re-weighted PCA plots</span>
<span class="c1"># fig, axs = plt.subplots(1,4, sharex=&#39;all&#39;, sharey=&#39;all&#39;)</span>
<span class="c1"># fig.set_size_inches(16,4)</span>

<span class="c1"># # for ax in axs:</span>
<span class="c1"># #     ax.set</span>

<span class="c1"># axs[0].scatter(g_dihe[:,0], g_dihe[:,1], c=g_weights, marker=&#39;.&#39;, cmap=&#39;Spectral_r&#39;, s=0.5)</span>
<span class="c1"># axs[0].set_title(&#39;GaMD&#39;)</span>

<span class="c1"># axs[1].scatter(a_dihe[:,0], a_dihe[:,1], c=a_weights, marker=&#39;.&#39;, cmap=&#39;Spectral_r&#39;, s=0.5)</span>
<span class="c1"># axs[1].set_title(&#39;aMD&#39;)</span>

<span class="c1"># axs[2].scatter(c_dihe[:,0], c_dihe[:,1], c=c_weights, marker=&#39;.&#39;, cmap=&#39;Spectral_r&#39;, s=0.5)</span>
<span class="c1"># axs[2].set_title(&#39;cMD&#39;)</span>

<span class="c1"># axs[3].scatter(g_dihe[:,0], g_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=1, label=&#39;GaMD&#39;)</span>
<span class="c1"># axs[3].scatter(a_dihe[:,0], a_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, label=&#39;aMD&#39;)</span>
<span class="c1"># axs[3].scatter(c_dihe[:,0], c_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, label=&#39;cMD&#39;)</span>
<span class="c1"># lgnd = axs[3].legend()</span>
<span class="c1"># for handle in lgnd.legendHandles:</span>
<span class="c1">#     handle.set_sizes([30.0])</span>
<span class="c1">#     handle.set_alpha(1)</span>

<span class="c1"># axs[3].set_title(&#39;Overlay&#39;)</span>
    
<span class="c1"># fig.savefig(snakemake.output.pca_dihe)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Load cluster data</span>
<span class="c1"># clus_g = md.load(snakemake.input.ga_clus)</span>
<span class="c1"># clus_a = md.load(snakemake.input.a_clus)</span>
<span class="c1"># clus_c = md.load(snakemake.input.c_clus)</span>
<span class="c1"># clusters = [clus_g, clus_a, clus_c]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Transform clusters in pca</span>
<span class="c1"># clusters_dih = []</span>
<span class="c1"># [clusters_dih.append(getDih(clus)) for clus in clusters]</span>
<span class="c1"># cluster_pca = []</span>
<span class="c1"># [cluster_pca.append(pca4.transform(clus)) for clus in clusters_dih]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Plot Clusters</span>
<span class="c1"># fig, ax = plt.subplots()</span>

<span class="c1"># methods = [&quot;GaMD&quot;, &quot;aMD&quot;, &quot;cMD&quot;]</span>
<span class="c1"># ax.scatter(g_dihe[:,0], g_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, c=&#39;grey&#39;)</span>
<span class="c1"># ax.scatter(a_dihe[:,0], a_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, c=&#39;grey&#39;)</span>
<span class="c1"># ax.scatter(c_dihe[:,0], c_dihe[:,1], marker=&#39;.&#39;, s=0.5, alpha=0.1, c=&#39;grey&#39;)</span>


<span class="c1"># # Plot clusters</span>
<span class="c1"># for clus, method in zip(cluster_pca, methods):</span>
<span class="c1">#     ax.scatter(clus[:,0], clus[:,1], marker=&#39;^&#39;, label=method)</span>
<span class="c1">#     for i, txt in enumerate(np.arange(len(clus[:,0]))):</span>
<span class="c1">#         ax.annotate(txt, (clus[i,0], clus[i,1], ))</span>
<span class="c1"># ax.legend()</span>
<span class="c1"># ax.set_title(&quot;Different clusters on dPCA plot&quot;)</span>
<span class="c1"># fig.savefig(snakemake.output.cluster_pca)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(&quot;Backbone RMSD between clusters. Array indices correspond to the cluster number in plot above.&quot;)</span>
<span class="c1"># from itertools import combinations_with_replacement</span>
<span class="c1"># cluster_pairs = list(combinations_with_replacement(clusters, 2))</span>
<span class="c1"># method_pairs = list(combinations_with_replacement(methods, 2))</span>
<span class="c1"># for v, w in zip(cluster_pairs, method_pairs):</span>
<span class="c1">#     i, j = v</span>
<span class="c1">#     i_n, j_n = w</span>
<span class="c1">#     print(f&quot;RMSD between {i_n} - {j_n}&quot;)</span>
<span class="c1">#     rmsd = np.zeros((i.n_frames, j.n_frames))</span>
<span class="c1">#     for a in range(i.n_frames):</span>
<span class="c1">#         for b in range(j.n_frames):</span>
<span class="c1">#             rmsd[a,b] = md.rmsd(i[a], j[b], atom_indices = i.top.select(&#39;backbone&#39;)) * 10</span>
<span class="c1">#     print(rmsd)</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "d-cru/test_report",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./22"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Daniel Crusius<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>