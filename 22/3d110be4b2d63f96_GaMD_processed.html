
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Principle Component Analysis (PCA) &#8212; Test Report</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.5f77b4aec8189eecf79907ce328c390d.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/test.js"></script>
    <script src="../_static/ngl.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Test Report</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Welcome to your Jupyter Book
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="intro_22.html">
   1. Compound 22
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ed6dd3148ef9b069_GaMD_processed.html">
     1.1. Analysis Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ed6dd3148ef9b069_GaMD_interactive.html">
     1.2. Interactive exploration
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks.html">
   2. Content with notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown.html">
   3. Markdown Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../there_test.html">
   4. TEST
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/22/3d110be4b2d63f96_GaMD_processed.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/d-cru/test_report"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/d-cru/test_report/issues/new?title=Issue%20on%20page%20%2F22/3d110be4b2d63f96_GaMD_processed.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/d-cru/test_report/main?urlpath=tree/test_report/22/3d110be4b2d63f96_GaMD_processed.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Principle Component Analysis (PCA)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cartesian-pca">
     Cartesian PCA
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pairwise-distances-pca">
     Pairwise distances PCA
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dihedral-pca">
     Dihedral PCA
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compute-noes">
   Compute NOEs
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !jupyter-nbextension enable nglview --py --sys-prefix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># analysis notebook</span>
<span class="c1"># methods are cMD, aMD, GaMD.</span>
<span class="c1"># in snakemake rule, method needs to be passed as a parameter. s.t. it is accessible via: snakemake.params.method</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="c1">#%matplotlib inline</span>
<span class="c1">#matplotlib.use(&quot;Agg&quot;)</span>

<span class="kn">import</span> <span class="nn">mdtraj</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.cluster.hierarchy</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">squareform</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="kn">import</span> <span class="nn">src</span>
<span class="kn">from</span> <span class="nn">src.noe</span> <span class="kn">import</span> <span class="n">compute_NOE_mdtraj</span><span class="p">,</span> <span class="n">plot_NOE</span>
<span class="kn">from</span> <span class="nn">src.pca</span> <span class="kn">import</span> <span class="n">make_PCA</span><span class="p">,</span> <span class="n">plot_PCA</span><span class="p">,</span> <span class="n">getDih</span>
<span class="kn">from</span> <span class="nn">src.pyreweight</span> <span class="kn">import</span> <span class="n">reweight</span>
<span class="kn">from</span> <span class="nn">src.analyse</span> <span class="kn">import</span> <span class="n">getOmega</span><span class="p">,</span> <span class="n">getDihedrals</span>
<span class="kn">from</span> <span class="nn">src.utils</span> <span class="kn">import</span> <span class="n">json_load</span><span class="p">,</span> <span class="n">pickle_dump</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="kn">import</span> <span class="nn">nglview</span> <span class="k">as</span> <span class="nn">nv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "273ae1a0875f4d4a8cfa1d0a9dba9ace", "version_major": 2, "version_minor": 0}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to make prelim. analysis faster. for production, use 1</span>
<span class="c1">#stride = int(snakemake.config[&#39;stride&#39;])</span>
<span class="n">stride</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compound_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">compound_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only load protein</span>
<span class="n">topo</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">load_frame</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">traj</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
<span class="n">protein</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;protein&#39;</span><span class="p">)</span>
<span class="n">protein</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
       51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
       68, 69])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">traj</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">atom_indices</span><span class="o">=</span><span class="n">protein</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">)</span>  <span class="c1"># added strideint for GaMD 2k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="c1"># Remove solvent from trajectory</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">restrict_atoms</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;protein&#39;</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">superpose</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;mdtraj.Trajectory with 526000 frames, 70 atoms, 5 residues, and unitcells&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for GaMD, skip equlibration...</span>
<span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GaMD&quot;</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">26000</span><span class="o">/</span><span class="n">stride</span><span class="p">):]</span> <span class="c1">#added 13000 instead of 26000 for 2k</span>
<span class="n">t</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;mdtraj.Trajectory with 500000 frames, 70 atoms, 5 residues, and unitcells at 0x7f6ef6983fd0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %matplotlib notebook</span>
<span class="c1"># v = nv.show_mdtraj(t)</span>
<span class="c1"># v.clear()</span>
<span class="c1"># v.add_ball_and_stick()</span>

<span class="c1"># # Load NOE data</span>
<span class="c1"># NOE = src.noe.read_NOE(snakemake.input.noe)</span>
<span class="c1"># NOE_number = 1</span>

<span class="c1"># a1 = eval(NOE[&#39;Atom 1&#39;][NOE_number])</span>
<span class="c1"># a2 = eval(NOE[&#39;Atom 2&#39;][NOE_number])</span>

<span class="c1"># NOE_pairs = []</span>

<span class="c1"># for a in a1:</span>
<span class="c1">#     for b in a2:</span>
<span class="c1">#         NOE_pairs.append([a,b])</span>
        
<span class="c1"># v.add_representation(&#39;distance&#39;, atom_pair=NOE_pairs, label_color=&#39;black&#39;, color=&#39;red&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compound</span> <span class="o">=</span> <span class="n">json_load</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">parm</span><span class="p">)</span>
<span class="n">multi</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">multi</span>
<span class="n">multi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">multiple</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">distinction</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">distinction</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Multiple compounds detected&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">multiple</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pickle_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">multiple</span><span class="p">,</span> <span class="n">multiple</span><span class="p">)</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>  <span class="c1"># if Compound.cistrans:</span>
    <span class="n">ca_c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;resid </span><span class="si">{</span><span class="n">distinction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and name CA C&quot;</span><span class="p">)</span>
    <span class="n">n_ca_next</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;resid </span><span class="si">{</span><span class="n">distinction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> and name N CA&quot;</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ca_c</span><span class="p">,</span> <span class="n">n_ca_next</span><span class="p">)</span>
    <span class="n">t_omega_rad</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">compute_dihedrals</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">[</span><span class="n">omega</span><span class="p">])</span>
    <span class="n">t_omega_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">t_omega_rad</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_omega_deg</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frames&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Omega 0-1 [°]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dihedral angle over time. Compound </span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t_omega_deg</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t_omega_deg</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pickle_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">multiple</span><span class="p">,</span> <span class="p">(</span><span class="n">cis</span><span class="p">,</span><span class="n">trans</span><span class="p">))</span>
    <span class="c1">#t[trans]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">omega</span> <span class="o">=</span> <span class="n">getOmega</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">omega_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_deg</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Omega angles over time. Compound </span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Omega angles over time. Compound 22&#39;)
</pre></div>
</div>
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_12_1.png" src="../_images/3d110be4b2d63f96_GaMD_processed_12_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">getDihedrals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">angle_mean</span><span class="p">(</span><span class="n">phi</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">angle_mean</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">angle_mean</span><span class="p">(</span><span class="n">omega</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ -80.051895  -57.86708   -96.1462   -144.48445   -92.01502 ] [-164.80684   -17.310507  -38.42978   -74.28314   -32.713226] [170.79971 173.31116 179.67564 166.7986  155.55496]
</pre></div>
</div>
</div>
</div>
<div class="section" id="principle-component-analysis-pca">
<h1>Principle Component Analysis (PCA)<a class="headerlink" href="#principle-component-analysis-pca" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cartesian-pca">
<h2>Cartesian PCA<a class="headerlink" href="#cartesian-pca" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_pca</span><span class="p">,</span> <span class="n">reduced_cartesian</span> <span class="o">=</span> <span class="n">make_PCA</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;cartesian&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_PCA</span><span class="p">(</span><span class="n">reduced_cartesian</span><span class="p">,</span> <span class="s1">&#39;cartesian&#39;</span><span class="p">,</span> <span class="n">compound_index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_17_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_17_0.png" />
</div>
</div>
</div>
<div class="section" id="pairwise-distances-pca">
<h2>Pairwise distances PCA<a class="headerlink" href="#pairwise-distances-pca" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pd_pca, reduced_pd = make_PCA(t, &#39;pairwise_d&#39;)</span>
<span class="c1"># fig, ax = plt.subplots()</span>
<span class="c1"># plt.close()</span>
<span class="c1"># ax = plot_PCA(reduced_pd, &#39;cartesian&#39;, compound_index, t.time, &#39;Time&#39;)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dihedral-pca">
<h2>Dihedral PCA<a class="headerlink" href="#dihedral-pca" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca_d</span><span class="p">,</span> <span class="n">reduced_dihedrals</span> <span class="o">=</span> <span class="n">make_PCA</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;dihedral&#39;</span><span class="p">)</span>
<span class="n">reduced_dihedrals_full</span> <span class="o">=</span> <span class="n">getDih</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># save pca object &amp; reduced dihedrals</span>
<span class="n">pickle_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">dPCA</span><span class="p">,</span> <span class="n">pca_d</span><span class="p">)</span>
<span class="n">pickle_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">,</span> <span class="n">reduced_dihedrals_full</span><span class="p">)</span>

<span class="c1"># reweighting:</span>
<span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cMD&quot;</span><span class="p">:</span>
    <span class="n">d_weights</span> <span class="o">=</span> <span class="n">reweight</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;noweight&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">weight_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">weight_data</span> <span class="o">=</span> <span class="n">weight_data</span><span class="p">[::</span><span class="n">stride</span><span class="p">]</span>
    <span class="n">d_weights</span> <span class="o">=</span> <span class="n">reweight</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">,</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="s1">&#39;amdweight_MC&#39;</span><span class="p">,</span> <span class="n">weight_data</span><span class="p">)</span>
    <span class="c1">#d_weights = reduced_dihedrals[:,0] * 0</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1">#plt.close()</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_PCA</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">,</span> <span class="s1">&#39;dihedral&#39;</span><span class="p">,</span> <span class="n">compound_index</span><span class="p">,</span> <span class="n">d_weights</span><span class="p">,</span> <span class="s1">&#39;Energy [kcal/mol]&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">plot_PCA_citra</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">[</span><span class="n">cis</span><span class="p">],</span> <span class="n">reduced_dihedrals</span><span class="p">[</span><span class="n">trans</span><span class="p">],</span> <span class="s1">&#39;dihedral&#39;</span><span class="p">,</span> <span class="n">compound_index</span><span class="p">,</span> <span class="p">[</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;cis&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (cis)&#39;</span><span class="p">,</span> <span class="n">multi</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (trans)&#39;</span><span class="p">],</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">pca_dihe</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_PCA</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">,</span> <span class="s1">&#39;dihedral&#39;</span><span class="p">,</span> <span class="n">compound_index</span><span class="p">,</span> <span class="n">d_weights</span><span class="p">,</span> <span class="s1">&#39;Energy [kcal/mol]&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">pca_dihe</span><span class="p">)</span>

<span class="n">pickle_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">dPCA_weights_MC</span><span class="p">,</span> <span class="n">d_weights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_21_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_21_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if compound_index == 22:</span>
<span class="c1">#     result = np.random.rand(2,10000)</span>

<span class="c1">#     for i in range(10000):</span>
<span class="c1">#         phi = [-173, -58, -102, -104, -77]</span>
<span class="c1">#         psi = [-171, -12, -77, -101, 46]</span>
<span class="c1">#         omega = (np.random.rand(1,5) - 0.5) * 2 * 180</span>
<span class="c1">#         #omega = [170, 170, 170, 170, 170]</span>

<span class="c1">#         d1 = np.cos(np.radians(phi))</span>
<span class="c1">#         d2 = np.sin(np.radians(phi))</span>
<span class="c1">#         d3 = np.cos(np.radians(psi))</span>
<span class="c1">#         d4 = np.sin(np.radians(psi))</span>
<span class="c1">#         d5 = np.cos(np.radians(omega[0]))</span>
<span class="c1">#         d6 = np.sin(np.radians(omega[0]))</span>

<span class="c1">#         manual = np.hstack((d1,d2,d3,d4,d5,d6))</span>
<span class="c1">#         result[:,i]= (pca_d.transform([manual]))</span>

<span class="c1">#     ax.scatter(result[0,:], result[1,:])</span>
<span class="c1">#     fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># result = np.random.rand(2,10000)</span>

<span class="c1"># for i in range(10000):</span>
<span class="c1">#     phi = [-169, -60, -116, -121, 51]</span>
<span class="c1">#     psi = [-160, -13, -84, 111, 42]</span>
<span class="c1">#     omega = (np.random.rand(1,5) - 0.5) * 2 * 180</span>
<span class="c1">#     #omega = [170, 170, 170, 170, 170]</span>

<span class="c1">#     d1 = np.cos(np.radians(phi))</span>
<span class="c1">#     d2 = np.sin(np.radians(phi))</span>
<span class="c1">#     d3 = np.cos(np.radians(psi))</span>
<span class="c1">#     d4 = np.sin(np.radians(psi))</span>
<span class="c1">#     d5 = np.cos(np.radians(omega[0]))</span>
<span class="c1">#     d6 = np.sin(np.radians(omega[0]))</span>

<span class="c1">#     manual = np.hstack((d1,d2,d3,d4,d5,d6))</span>
<span class="c1">#     result[:,i]= (pca_d.transform([manual]))</span>
<span class="c1"># ax.scatter(result[0,:], result[1,:])</span>
<span class="c1"># fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pos = reduced_dihedrals</span>
<span class="c1"># src.utils.link_ngl_wdgt_to_ax_pos(ax, pos, v)</span>
<span class="c1"># v</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># phi, psi, omega = getDihedrals(t[95852])</span>
<span class="c1"># print(np.mean(np.degrees(phi), axis=0), np.mean(np.degrees(psi), axis=0), np.mean(np.degrees(omega), axis=0))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clustering</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TSNE dimensionality reduction</span>
<span class="n">dihe</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">getDih</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">tsne_results</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dihe</span><span class="p">[::</span><span class="mi">125</span><span class="p">,:])</span> <span class="c1"># 250</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsne_results</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">tsne_results</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[t-SNE] Computing 151 nearest neighbors...
[t-SNE] Indexed 4000 samples in 0.000s...
[t-SNE] Computed neighbors for 4000 samples in 0.219s...
[t-SNE] Computed conditional probabilities for sample 1000 / 4000
[t-SNE] Computed conditional probabilities for sample 2000 / 4000
[t-SNE] Computed conditional probabilities for sample 3000 / 4000
[t-SNE] Computed conditional probabilities for sample 4000 / 4000
[t-SNE] Mean sigma: 0.256961
[t-SNE] KL divergence after 250 iterations with early exaggeration: 73.498703
[t-SNE] KL divergence after 2000 iterations: 1.714721
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7f6ef6c25f40&gt;
</pre></div>
</div>
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_28_2.png" src="../_images/3d110be4b2d63f96_GaMD_processed_28_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Derive epsilon for DBSCAN-clustering from data: epsilon = max distance between nearest neighbors</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tsne_results</span><span class="p">)</span> <span class="c1">#</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">tsne_results</span><span class="p">)</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="n">distances</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NN-distances in tsne plot&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;NN-distance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_29_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_29_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform DBSCAN-clustering with varying min_samples parameter</span>
<span class="n">num_clusters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">num_noise</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tsne_results</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span>
    <span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">n_noise</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">num_clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">)</span>
    <span class="n">num_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_noise</span><span class="p">)</span>
    
<span class="c1"># Drop all points following the first detection of 0 clusters</span>
<span class="n">num_clusters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">num_clusters</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="n">num_clusters</span><span class="o">=</span><span class="n">num_clusters</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10 10 10  9  8  6  5  5  5  5  5  5  5  6  6  6  6  5  6  7  9 11 12 15
 21 23 22 21 24 21 21 17 13 12 10  8  8  9  7  6  6  5  4  4  4  4  3  3
  3  1  1  1  1  1  1  1  1  1  1]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit polynomial to detect right-most plateau</span>
<span class="n">mymodel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_clusters</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">deriv</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>
<span class="n">roots</span> <span class="o">=</span> <span class="n">deriv</span><span class="o">.</span><span class="n">roots</span>

<span class="c1"># discard complex roots</span>
<span class="n">r_roots</span> <span class="o">=</span> <span class="n">roots</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">roots</span><span class="p">)]</span><span class="o">.</span><span class="n">real</span>

<span class="c1"># discard negative values</span>
<span class="n">r_roots</span> <span class="o">=</span> <span class="n">r_roots</span><span class="p">[</span><span class="n">r_roots</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># discard values greater than x.max()</span>
<span class="n">r_roots</span> <span class="o">=</span> <span class="n">r_roots</span><span class="p">[</span><span class="n">r_roots</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># Take largest root</span>
<span class="k">if</span> <span class="n">r_roots</span> <span class="o">!=</span> <span class="p">[]:</span>
    <span class="n">min_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r_roots</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;min_samples = </span><span class="si">{</span><span class="n">min_samples</span><span class="si">}</span><span class="s2"> was selected as parameter for clustering&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Caution! min samples parameter was selected as fixed value b/c automatic determination failed. specify the parameter manually in the config!&#39;</span><span class="p">)</span>

<span class="c1"># If config overrides, use config value:</span>
<span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;cluster_conf&quot;</span><span class="p">]:</span>
    <span class="n">min_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;cluster_conf&quot;</span><span class="p">][</span><span class="n">snakemake</span><span class="o">.</span><span class="n">wildcards</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Override: Use min_samples=</span><span class="si">{</span><span class="n">min_samples</span><span class="si">}</span><span class="s2"> instead of the above determined parameter&quot;</span><span class="p">)</span>

<span class="c1"># if str(compound_index) in snakemake.config[f&quot;{snakemake.params.method}_clustering&quot;]:</span>
<span class="c1">#     min_samples = int(snakemake.config[f&quot;{snakemake.params.method}_clustering&quot;][f&quot;{compound_index}&quot;])</span>
<span class="c1">#     print(f&quot;Override: Use min_samples={min_samples} instead of the above determined parameter&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min_samples = 48 was selected as parameter for clustering
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_21043/2568508546.py:17: DeprecationWarning: elementwise comparison failed; this will raise an error in the future.
  if r_roots != []:
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># min_samples = 8</span>
<span class="c1"># print(f&quot;Override: Use min_samples={min_samples} instead of the above determined parameter&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">num_clusters</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;clustering with different min_sample parm.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mymodel</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;poly-fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">min_samples</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num_clusters</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;selected min_sample paramter&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;derivative of poly-fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Determining min_samples parameter for clustering&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;min_samples parameter&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of clusters observed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_min_samp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_33_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_33_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_noise</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Number of points classified as noise&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;min_samples parameter&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of points classified as noise&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Number of points classified as noise&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_34_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_34_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform clustering for selected min_samples parameter</span>
<span class="n">clustering</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tsne_results</span><span class="p">)</span>

<span class="n">threshhold</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># 0.05</span>

<span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">n_clusters</span><span class="si">}</span><span class="s2"> clusters&quot;</span><span class="p">)</span>

<span class="n">cluster_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cluster_label_filter</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cluster</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">threshhold</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>
            <span class="n">clus_points</span> <span class="o">=</span> <span class="n">tsne_results</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clus_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">clus_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="s2"> makes up more than 5% of points. (</span><span class="si">{</span><span class="n">percentage</span> <span class="o">*</span> <span class="mi">100</span><span class="si">}</span><span class="s2"> % of total points)&quot;</span><span class="p">)</span>
            <span class="n">cluster_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">)</span>
            <span class="n">cluster_label_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clus_points</span> <span class="o">=</span> <span class="n">tsne_results</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clus_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">clus_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exlude Cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="s2"> is less than 5% of points. (</span><span class="si">{</span><span class="n">percentage</span> <span class="o">*</span> <span class="mi">100</span><span class="si">}</span><span class="s2"> % of total points)&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">clus_points</span> <span class="o">=</span> <span class="n">tsne_results</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clus_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">clus_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Noise&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
        
        <span class="n">percentage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">[</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Noise makes up </span><span class="si">{</span><span class="n">percentage</span> <span class="o">*</span> <span class="mi">100</span><span class="si">}</span><span class="s2"> % of total points.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Clusters and associated points. Noise and clusters with &lt; 5</span><span class="si">% o</span><span class="s1">f points are shown in faded&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 3 clusters
Cluster 0 makes up more than 5% of points. (2.375 % of total points)
Cluster 1 makes up more than 5% of points. (1.2 % of total points)
Cluster 2 makes up more than 5% of points. (1.25 % of total points)
Noise makes up 95.175 % of total points.
</pre></div>
</div>
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_35_1.png" src="../_images/3d110be4b2d63f96_GaMD_processed_35_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Clusters over time (-1 is noise)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Snapshot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cluster&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_36_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_36_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find cluster points in original trajectory, compute average structure, </span>
<span class="c1"># then find closest (min-rmsd) cluster structure to this</span>
<span class="n">reduced_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dihe</span><span class="p">),</span> <span class="mi">125</span><span class="p">)</span>
<span class="n">reduced_g_dihe</span> <span class="o">=</span> <span class="n">dihe</span><span class="p">[</span><span class="n">reduced_ind</span><span class="p">,:]</span>
<span class="n">cluster_min_pca</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cluster_index</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">timestep</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_points</span><span class="p">,</span> <span class="n">cluster_label_filter</span><span class="p">):</span>
    
    <span class="c1"># cluster points in original trajectory</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">reduced_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">avg_struct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">avg_t</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">Trajectory</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">avg_struct</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># compute average dihedral angles for each cluster:</span>
    <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">getDihedrals</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">angle_mean</span><span class="p">(</span><span class="n">phi</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">angle_mean</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">angle_mean</span><span class="p">(</span><span class="n">omega</span><span class="p">)))</span>
    
    <span class="c1"># find min-RMSD structure to the average</span>
    <span class="n">rmsd</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">rmsd</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">avg_t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">min_rmsd_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rmsd</span> <span class="o">==</span> <span class="n">rmsd</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">cluster_min</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">indices</span><span class="p">][</span><span class="n">min_rmsd_idx</span><span class="p">]</span>
    <span class="n">cluster_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">cluster_min</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">: Closest min structure is frame </span><span class="si">{</span><span class="nb">int</span><span class="p">((</span><span class="n">cluster_min</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span><span class="si">}</span><span class="s2"> (time: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">cluster_min</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="c1"># Compute dihedrals of min-RMSD cluster structure, and transform to PCA</span>
    <span class="n">cluster_min</span> <span class="o">=</span> <span class="n">getDih</span><span class="p">(</span><span class="n">cluster_min</span><span class="p">)</span>
    <span class="n">cluster_min_pca</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pca_d</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">cluster_min</span><span class="p">))</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-169.14536   -58.036587 -104.68576  -139.26797   -83.92988 ] [-168.58476   -13.188578  -48.68371   -85.06564    29.014116] [ 167.30614  174.19621 -178.7051   166.34908 -159.71866]
Cluster 0: Closest min structure is frame 449875 (time: 951752.0)
[-153.23332   -69.84503  -123.040825 -141.97879   -80.902374] [-67.065956 -37.744415 -38.530025 -60.52685  -28.929985] [-178.79297 -177.60092 -176.92853  177.39827  165.03015]
Cluster 1: Closest min structure is frame 343500 (time: 739002.0)
[-147.89484   -61.543896 -150.77565   -88.04757  -138.1718  ] [-60.045002 -36.05165  -60.71765  -27.326473 -30.560884] [ 172.1853   175.90788 -175.64601 -179.24275  164.33278]
Cluster 2: Closest min structure is frame 376375 (time: 804752.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot cluster mins in d-PCA plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">reduced_dihedrals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_min_pca</span><span class="p">,</span> <span class="n">cluster_label_filter</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">i</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Dihedral PCA, and associated cluster minima&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_pca</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_21043/210811007.py:8: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.savefig(snakemake.output.cluster_pca)
/biggin/b147/univ4859/research/03_macroconf/.snakemake/conda/f5d5b4035c920881ad665ab11a2501c8/lib/python3.8/site-packages/IPython/core/pylabtools.py:134: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_38_1.png" src="../_images/3d110be4b2d63f96_GaMD_processed_38_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_traj</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">cluster_index</span><span class="p">]</span>
<span class="n">cluster_traj</span><span class="o">.</span><span class="n">superpose</span><span class="p">(</span><span class="n">cluster_traj</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atom_indices</span> <span class="o">=</span> <span class="n">cluster_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">))</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">show_mdtraj</span><span class="p">(</span><span class="n">cluster_traj</span><span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "e51d4cc57d6a4c37bac65b97ef158333", "version_major": 2, "version_minor": 0}
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute rmsd between clusters</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">rmsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
    <span class="n">rmsd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">rmsd</span><span class="p">(</span><span class="n">cluster_traj</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cluster_traj</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">atom_indices</span> <span class="o">=</span> <span class="n">cluster_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">rmsd</span>
<span class="c1">#md.rmsd(cluster_traj) * 10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.        , 0.6507051 , 1.18263853],
       [0.        , 0.        , 0.75034386],
       [0.        , 0.        , 0.        ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute dihedral angles</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">getOmega</span><span class="p">(</span><span class="n">cluster_traj</span><span class="p">)</span>
<span class="n">omega_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_deg</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Omega angles over time. Compound </span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_42_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_42_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># view = nv.show_mdtraj(cluster_traj)</span>
<span class="c1"># view</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import tempfile</span>
<span class="c1"># tmp_dir = tempfile.mkdtemp()</span>
<span class="c1"># pdb_temp = tempfile.mktemp(suffix=&quot;.pdb&quot;, dir=tmp_dir)</span>
<span class="c1"># png_temp = tempfile.mktemp(suffix=&quot;.pdb&quot;, dir=tmp_dir)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">save_pdb</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_pdb</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pymol_script</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;load </span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_pdb</span><span class="si">}</span><span class="s2"></span>
<span class="s2"># inspired by: https://gist.github.com/bobbypaton/1cdc4784f3fc8374467bae5eb410edef</span>
<span class="s2">cmd.bg_color(&quot;white&quot;)</span>
<span class="s2">cmd.set(&quot;ray_opaque_background&quot;, &quot;off&quot;)</span>
<span class="s2">cmd.set(&quot;orthoscopic&quot;, 0)</span>
<span class="s2">cmd.set(&quot;transparency&quot;, 0.1)</span>
<span class="s2">cmd.set(&quot;dash_gap&quot;, 0)</span>
<span class="s2">cmd.set(&quot;ray_trace_mode&quot;, 1)</span>
<span class="s2">cmd.set(&quot;ray_texture&quot;, 2)</span>
<span class="s2">cmd.set(&quot;antialias&quot;, 3)</span>
<span class="s2">cmd.set(&quot;ambient&quot;, 0.5)</span>
<span class="s2">cmd.set(&quot;spec_count&quot;, 5)</span>
<span class="s2">cmd.set(&quot;shininess&quot;, 50)</span>
<span class="s2">cmd.set(&quot;specular&quot;, 1)</span>
<span class="s2">cmd.set(&quot;reflect&quot;, .1)</span>
<span class="s2">cmd.space(&quot;cmyk&quot;)</span>

<span class="s2">#cmd.cartoon(&quot;oval&quot;)</span>
<span class="s2">cmd.show(&quot;sticks&quot;)</span>
<span class="s2">cmd.show(&quot;spheres&quot;)</span>
<span class="s2">cmd.color(&quot;gray85&quot;,&quot;elem C&quot;)</span>
<span class="s2">cmd.color(&quot;gray98&quot;,&quot;elem H&quot;)</span>
<span class="s2">cmd.color(&quot;slate&quot;,&quot;elem N&quot;)</span>
<span class="s2">cmd.color(&quot;red&quot;,&quot;elem O&quot;)</span>
<span class="s2">cmd.set(&quot;stick_radius&quot;,0.07)</span>
<span class="s2">cmd.set(&quot;sphere_scale&quot;,0.18)</span>
<span class="s2">cmd.set(&quot;sphere_scale&quot;,0.13, &quot;elem H&quot;)</span>
<span class="s2">cmd.set(&quot;dash_gap&quot;,0.01)</span>
<span class="s2">cmd.set(&quot;dash_radius&quot;,0.07)</span>
<span class="s2">cmd.set(&quot;stick_color&quot;,&quot;black&quot;)</span>
<span class="s2">cmd.set(&quot;dash_gap&quot;,0.01)</span>
<span class="s2">cmd.set(&quot;dash_radius&quot;,0.035)</span>
<span class="s2">cmd.hide(&quot;nonbonded&quot;)</span>
<span class="s2">cmd.hide(&quot;cartoon&quot;)</span>
<span class="s2">cmd.hide(&quot;lines&quot;)</span>
<span class="s2">cmd.orient()</span>
<span class="s2">cmd.zoom()</span>
<span class="s2">cmd.hide(&quot;labels&quot;)</span>

<span class="s2">cmd.mpng(&quot;</span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cluster_dir</span><span class="si">}</span><span class="s2">test_&quot;, width=1000, height=1000)</span>

<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pymol_script_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cluster_dir</span><span class="si">}</span><span class="s2">pym.pml&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pymol_script_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pymol_script</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pymol -c <span class="nv">$pymol_script_file</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> PyMOL(TM) Molecular Graphics System, Version 2.5.0.
 Copyright (c) Schrodinger, LLC.
 All Rights Reserved.
 
    Created by Warren L. DeLano, Ph.D. 
 
    PyMOL is user-supported open-source software.  Although some versions
    are freely available, PyMOL is not in the public domain.
 
    If PyMOL is helpful in your work or study, then please volunteer 
    support for our ongoing efforts to create open and affordable scientific
    software by purchasing a PyMOL Maintenance and/or Support subscription.

    More information can be found at &quot;http://www.pymol.org&quot;.
 
    Enter &quot;help&quot; for a list of commands.
    Enter &quot;help &lt;command-name&gt;&quot; for information on a specific command.

 Hit ESC anytime to toggle between text and graphics.

 Detected 24 CPU cores.  Enabled multithreaded rendering.
PyMOL&gt;load data/processed/refactor-test/results/22/H2O/GaMD/1000/0/3d110be4b2d63f96_clusters/clusters.pdb
 ObjectMolecule: Read crystal symmetry information.
 ObjectMoleculeReadPDBStr: read MODEL 1
 ObjectMoleculeReadPDBStr: read MODEL 2
 ObjectMoleculeReadPDBStr: read MODEL 3
 CmdLoad: &quot;&quot; loaded as &quot;clusters&quot;.
PyMOL&gt;cmd.bg_color(&quot;white&quot;)
PyMOL&gt;cmd.set(&quot;ray_opaque_background&quot;, &quot;off&quot;)
PyMOL&gt;cmd.set(&quot;orthoscopic&quot;, 0)
PyMOL&gt;cmd.set(&quot;transparency&quot;, 0.1)
PyMOL&gt;cmd.set(&quot;dash_gap&quot;, 0)
PyMOL&gt;cmd.set(&quot;ray_trace_mode&quot;, 1)
PyMOL&gt;cmd.set(&quot;ray_texture&quot;, 2)
PyMOL&gt;cmd.set(&quot;antialias&quot;, 3)
PyMOL&gt;cmd.set(&quot;ambient&quot;, 0.5)
PyMOL&gt;cmd.set(&quot;spec_count&quot;, 5)
PyMOL&gt;cmd.set(&quot;shininess&quot;, 50)
PyMOL&gt;cmd.set(&quot;specular&quot;, 1)
PyMOL&gt;cmd.set(&quot;reflect&quot;, .1)
PyMOL&gt;cmd.space(&quot;cmyk&quot;)
 Color: loaded table &#39;/biggin/b147/univ4859/research/03_macroconf/.snakemake/conda/f5d5b4035c920881ad665ab11a2501c8/lib/python3.8/site-packages/pymol/pymol_path/data/pymol/cmyk.png&#39;.
PyMOL&gt;cmd.show(&quot;sticks&quot;)
PyMOL&gt;cmd.show(&quot;spheres&quot;)
PyMOL&gt;cmd.color(&quot;gray85&quot;,&quot;elem C&quot;)
PyMOL&gt;cmd.color(&quot;gray98&quot;,&quot;elem H&quot;)
PyMOL&gt;cmd.color(&quot;slate&quot;,&quot;elem N&quot;)
PyMOL&gt;cmd.color(&quot;red&quot;,&quot;elem O&quot;)
PyMOL&gt;cmd.set(&quot;stick_radius&quot;,0.07)
PyMOL&gt;cmd.set(&quot;sphere_scale&quot;,0.18)
PyMOL&gt;cmd.set(&quot;sphere_scale&quot;,0.13, &quot;elem H&quot;)
PyMOL&gt;cmd.set(&quot;dash_gap&quot;,0.01)
PyMOL&gt;cmd.set(&quot;dash_radius&quot;,0.07)
PyMOL&gt;cmd.set(&quot;stick_color&quot;,&quot;black&quot;)
PyMOL&gt;cmd.set(&quot;dash_gap&quot;,0.01)
PyMOL&gt;cmd.set(&quot;dash_radius&quot;,0.035)
PyMOL&gt;cmd.hide(&quot;nonbonded&quot;)
PyMOL&gt;cmd.hide(&quot;cartoon&quot;)
PyMOL&gt;cmd.hide(&quot;lines&quot;)
PyMOL&gt;cmd.orient()
PyMOL&gt;cmd.zoom()
PyMOL&gt;cmd.hide(&quot;labels&quot;)
PyMOL&gt;cmd.mpng(&quot;data/processed/refactor-test/results/22/H2O/GaMD/1000/0/3d110be4b2d63f96_clusters/test_&quot;, width=1000, height=1000)
 Movie: frame    1 of    3, 1.07 sec. (0:00:03 - 0:00:03 to go).
 Movie: frame    2 of    3, 0.98 sec. (0:00:01 - 0:00:02 to go).
 Movie: frame    3 of    3, 0.99 sec. (0:00:00 - 0:00:01 to go).
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cluster_imgs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cluster_dir</span><span class="si">}</span><span class="s2">test_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">)]</span>

<span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">))</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">cluster_imgs</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;images read&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>images read
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="c1">#get default colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
<span class="c1"># make colors longer if more clusters than colors...</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_label_filter</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Colors appended..&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_label_filter</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_label_filter</span><span class="p">))</span>
<span class="c1"># plot cluster images</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">):</span>
    <span class="c1">#print(f&quot;final {i}&quot;)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#axs[i,0].tick_params(axis=&#39;y&#39;, which=&#39;both&#39;, bottom=False, top=False, labelbottom=False)</span>
<span class="c1"># plot corresponding pca&#39;s:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reduced_dihedrals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">reduced_dihedrals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1"># add cluster representations</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">iii</span><span class="p">,</span><span class="n">iiii</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_min_pca</span><span class="p">,</span> <span class="n">cluster_label_filter</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_label_filter</span><span class="p">))):</span>
    <span class="n">clus</span><span class="p">,</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">iiii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ii</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">ii</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">iii</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">iiii</span><span class="p">])</span>
    <span class="c1">#clus.get_color()</span>
    

    
<span class="n">NOE_path</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">noe</span>

<span class="c1"># add noe plots</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cluster_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">),</span> <span class="n">cluster_index</span><span class="p">,</span> <span class="n">cluster_label_filter</span><span class="p">):</span>
    <span class="n">NOE</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">noe</span><span class="o">.</span><span class="n">read_NOE</span><span class="p">(</span><span class="n">NOE_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="n">NOE_trans</span><span class="p">,</span> <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE</span>
        <span class="n">NOE_cis_dict</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">NOE_trans_dict</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">NOE_dict</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>

    <span class="n">current_cluster</span> <span class="o">=</span> <span class="n">cluster_traj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1">#print(j)</span>
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cis</span><span class="p">:</span>
            <span class="c1">#print(&quot;cis&quot;)</span>
            <span class="n">NOE_dict</span> <span class="o">=</span> <span class="n">NOE_cis_dict</span>
            <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE_cis</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> (cis)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#print(&quot;trans!&quot;)</span>
            <span class="n">NOE_dict</span> <span class="o">=</span> <span class="n">NOE_trans_dict</span>
            <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE_trans</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> (trans)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">NOE</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span><span class="n">_</span><span class="p">,</span><span class="n">_2</span><span class="p">,</span><span class="n">NOE_dist</span><span class="p">,</span> <span class="n">_3</span> <span class="o">=</span> <span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_dict</span><span class="p">,</span> <span class="n">current_cluster</span><span class="p">)</span>
    <span class="c1"># Deal with ambigous NOEs</span>
    <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">)</span>
    <span class="c1"># and ambigous/multiple values</span>
    <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>   
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">cluster_structs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_50_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_50_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="compute-noes">
<h1>Compute NOEs<a class="headerlink" href="#compute-noes" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NOE_path</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">noe</span>
<span class="n">NOE</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">noe</span><span class="o">.</span><span class="n">read_NOE</span><span class="p">(</span><span class="n">NOE_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">noe</span>
<span class="n">NOE_output</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">NOE_trans</span><span class="p">,</span> <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE</span>
    <span class="n">NOE_cis_dict</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">NOE_trans_dict</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">NOE_cis</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span><span class="n">_</span><span class="p">,</span><span class="n">_2</span><span class="p">,</span><span class="n">NOE_dist_cis</span><span class="p">,</span><span class="n">_3</span> <span class="o">=</span> <span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_cis_dict</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">cis</span><span class="p">])</span>
        
        <span class="n">NOE_output</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;cis&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="c1"># Deal with ambigous NOEs</span>
        <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">)</span>
        <span class="c1"># and ambigous/multiple values</span>
        <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE_cis</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compound </span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;cis&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (cis)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cis skipped because no frames are cis.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">NOE_trans</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span><span class="n">_</span><span class="p">,</span><span class="n">_2</span><span class="p">,</span><span class="n">NOE_dist_trans</span><span class="p">,</span> <span class="n">_3</span> <span class="o">=</span> <span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_trans_dict</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">trans</span><span class="p">])</span>
        
        <span class="n">NOE_output</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="c1"># Deal with ambigous NOEs</span>
        <span class="n">NOE_trans</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">)</span>
        <span class="c1"># and ambigous/multiple values</span>
        <span class="n">NOE_trans</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE_trans</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compound </span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (trans)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trans skipped because no frames are cis&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">NOE_dict</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">NOE</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span><span class="n">_</span><span class="p">,</span><span class="n">_2</span><span class="p">,</span> <span class="n">NOE_dist</span><span class="p">,</span> <span class="n">_3</span> <span class="o">=</span> <span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_dict</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Save NOE dict</span>
    <span class="n">NOE_output</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">NOE</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)}</span>
    <span class="c1"># Deal with ambigous NOEs</span>
    <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">)</span>
    <span class="c1"># and ambigous/multiple values</span>
    <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compound </span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">. NOE&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_plot</span><span class="p">)</span>
<span class="c1"># save as .json file</span>
<span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">json_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_result</span><span class="p">,</span> <span class="n">NOE_output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_54_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_54_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Reweighted NOEs</span>

<span class="c1"># if snakemake.params.method != &quot;cMD&quot;:</span>
<span class="c1">#     if multiple:</span>
<span class="c1">#         fig, axs = plt.subplots(2,1)</span>
<span class="c1">#         fig.set_size_inches(10,6)</span>
<span class="c1">#         NOE_trans, NOE_cis = NOE</span>
<span class="c1">#         NOE_cis_dict = NOE_cis.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#         NOE_trans_dict = NOE_trans.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#         if len(cis) &gt; 0:</span>
<span class="c1">#             NOE_cis[&#39;md&#39;],_,_2,NOE_dist_cis, pmf_plt_cis = compute_NOE_mdtraj(NOE_cis_dict, t[cis], snakemake.input.weights, 0, cis)</span>
<span class="c1">#             # Deal with ambigous NOEs</span>
<span class="c1">#             NOE_cis = NOE_cis.explode(&#39;md&#39;)</span>
<span class="c1">#             # and ambigous/multiple values</span>
<span class="c1">#             NOE_cis = NOE_cis.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#             fig, axs[1] = plot_NOE(NOE_cis, fig, axs[1])</span>
<span class="c1">#             axs[1].set_title(f&quot;Compound {multi[&#39;cis&#39;]} (cis)&quot;)</span>
<span class="c1">#         else:</span>
<span class="c1">#             print(&quot;Cis skipped because no frames are cis.&quot;)</span>
<span class="c1">#         if len(trans) &gt; 0:</span>
<span class="c1">#             NOE_trans[&#39;md&#39;],_,_2,NOE_dist_trans, pmf_plot_trans = compute_NOE_mdtraj(NOE_trans_dict, t[trans], snakemake.input.weights, 0, trans)</span>
<span class="c1">#              # Deal with ambigous NOEs</span>
<span class="c1">#             NOE_trans = NOE_trans.explode(&#39;md&#39;)</span>
<span class="c1">#             # and ambigous/multiple values</span>
<span class="c1">#             NOE_trans = NOE_trans.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#             fig, axs[0] = plot_NOE(NOE_trans, fig, axs[0])</span>
<span class="c1">#             axs[0].set_title(f&quot;Compound {multi[&#39;trans&#39;]} (trans)&quot;)</span>
<span class="c1">#         else:</span>
<span class="c1">#             print(&quot;Trans skipped because no frames are cis&quot;)</span>
<span class="c1">#     else:</span>
<span class="c1">#         NOE = src.noe.read_NOE(NOE_path)</span>
<span class="c1">#         NOE_dict = NOE.to_dict(orient=&#39;index&#39;)</span>
<span class="c1">#         NOE[&#39;md&#39;], *_ = src.noe.compute_NOE_mdtraj(NOE_dict, t, snakemake.input.weights)</span>
<span class="c1">#         # Deal with ambigous NOEs</span>
<span class="c1">#         NOE = NOE.explode(&#39;md&#39;)</span>
<span class="c1">#         # and ambigous/multiple values</span>
<span class="c1">#         NOE = NOE.explode(&#39;NMR exp&#39;)</span>
<span class="c1">#         fig, ax = plot_NOE(NOE)</span>
<span class="c1">#         ax.set_title(f&quot;Compound {compound_index}. NOE&quot;)</span>
<span class="c1">#         fig.tight_layout()</span>
<span class="c1">#         fig.tight_layout()</span>
<span class="c1">#         fig.savefig(snakemake.output.noe_plot)</span>
<span class="c1"># else:</span>
<span class="c1">#     print(&quot;cMD - no reweighted NOEs performed.&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1d PMF reweighted NOEs</span>

<span class="n">NOE_output</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;cMD&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">NOE_trans</span><span class="p">,</span> <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE</span>
        <span class="n">NOE_cis_dict</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">NOE_trans_dict</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">NOE_cis</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span><span class="n">NOE_cis</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">NOE_cis</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span><span class="n">NOE_dist_cis</span><span class="p">,</span> <span class="n">pmf_plot_cis</span> <span class="o">=</span> <span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_cis_dict</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">cis</span><span class="p">],</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cis</span><span class="p">)</span>
            
            <span class="n">NOE_output</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;cis&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
            
            <span class="c1"># Deal with ambigous NOEs</span>
            <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">explode</span><span class="p">([</span><span class="s1">&#39;md&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>
            <span class="c1"># and ambigous/multiple values</span>
            <span class="n">NOE_cis</span> <span class="o">=</span> <span class="n">NOE_cis</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE_cis</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compound </span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;cis&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (cis)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cis skipped because no frames are cis.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">NOE_trans</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span><span class="n">NOE_trans</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">NOE_trans</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span><span class="n">NOE_dist_trans</span><span class="p">,</span> <span class="n">pmf_plot_trans</span> <span class="o">=</span> <span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_trans_dict</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">trans</span><span class="p">],</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">trans</span><span class="p">)</span>
            
            <span class="n">NOE_output</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
            <span class="c1"># Deal with ambigous NOEs</span>
            <span class="n">NOE_trans</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">explode</span><span class="p">([</span><span class="s1">&#39;md&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>
            <span class="c1"># and ambigous/multiple values</span>
            <span class="n">NOE_trans</span> <span class="o">=</span> <span class="n">NOE_trans</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE_trans</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compound </span><span class="si">{</span><span class="n">multi</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (trans)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trans skipped because no frames are cis&quot;</span><span class="p">)</span>
        <span class="c1">#NOE_output = {f&quot;{multi[cis]}&quot;: NOE_cis, f&quot;{multi[trans]}&quot;: NOE_trans}</span>
        <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">json_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_result</span><span class="p">,</span> <span class="n">NOE_output</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_plot</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">NOE</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">noe</span><span class="o">.</span><span class="n">read_NOE</span><span class="p">(</span><span class="n">NOE_path</span><span class="p">)</span>
        <span class="n">NOE_dict</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">NOE</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">],</span> <span class="n">NOE</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">NOE</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_</span><span class="p">,</span> <span class="n">pmf_plot</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">noe</span><span class="o">.</span><span class="n">compute_NOE_mdtraj</span><span class="p">(</span><span class="n">NOE_dict</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">weight_data</span><span class="o">=</span><span class="n">weight_data</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Save NOE dict</span>
        <span class="n">NOE_output</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">NOE</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)}</span>
        <span class="c1"># save as .json file</span>
        <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">json_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_result</span><span class="p">,</span> <span class="n">NOE_output</span><span class="p">)</span>
        
        <span class="c1"># Deal with ambigous NOEs</span>
        <span class="c1">#NOE = NOE.explode(&#39;md&#39;)</span>
        <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">([</span><span class="s1">&#39;md&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>
        <span class="c1"># and ambigous/multiple values</span>
        <span class="n">NOE</span> <span class="o">=</span> <span class="n">NOE</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_NOE</span><span class="p">(</span><span class="n">NOE</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compound </span><span class="si">{</span><span class="n">compound_index</span><span class="si">}</span><span class="s2">. NOE&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_plot</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cMD - no reweighted NOEs performed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_56_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_56_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NOE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Atom 1</th>
      <th>Atom 2</th>
      <th>NMR exp</th>
      <th>lower bound</th>
      <th>upper bound</th>
      <th>md</th>
      <th>lower</th>
      <th>upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(3,)</td>
      <td>(26,)</td>
      <td>3.19</td>
      <td>0.0</td>
      <td>3.51</td>
      <td>4.255253</td>
      <td>4.092113</td>
      <td>4.639608</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(3,)</td>
      <td>(13, 14)</td>
      <td>1.83</td>
      <td>0.0</td>
      <td>3.16</td>
      <td>3.235446</td>
      <td>2.941103</td>
      <td>3.732762</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(3,)</td>
      <td>(13, 14)</td>
      <td>1.83</td>
      <td>0.0</td>
      <td>3.16</td>
      <td>2.299837</td>
      <td>2.191304</td>
      <td>3.113714</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(22,)</td>
      <td>(26,)</td>
      <td>2.93</td>
      <td>0.0</td>
      <td>3.22</td>
      <td>3.346273</td>
      <td>3.072609</td>
      <td>3.541959</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(19, 20)</td>
      <td>(26,)</td>
      <td>2.73</td>
      <td>0.0</td>
      <td>4.27</td>
      <td>3.097807</td>
      <td>2.786248</td>
      <td>3.543711</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(19, 20)</td>
      <td>(26,)</td>
      <td>2.73</td>
      <td>0.0</td>
      <td>4.27</td>
      <td>4.249252</td>
      <td>4.022555</td>
      <td>4.494861</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(16, 17)</td>
      <td>(26,)</td>
      <td>2.71</td>
      <td>0.0</td>
      <td>4.24</td>
      <td>3.478082</td>
      <td>2.606915</td>
      <td>4.803864</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(16, 17)</td>
      <td>(26,)</td>
      <td>2.71</td>
      <td>0.0</td>
      <td>4.24</td>
      <td>4.711501</td>
      <td>4.266601</td>
      <td>5.000795</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(13, 14)</td>
      <td>(26,)</td>
      <td>2.63</td>
      <td>0.0</td>
      <td>4.14</td>
      <td>2.902224</td>
      <td>2.664539</td>
      <td>3.437414</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(13, 14)</td>
      <td>(26,)</td>
      <td>2.63</td>
      <td>0.0</td>
      <td>4.14</td>
      <td>4.100673</td>
      <td>3.934479</td>
      <td>4.395087</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(47,)</td>
      <td>(59,)</td>
      <td>2.57</td>
      <td>0.0</td>
      <td>2.83</td>
      <td>3.463446</td>
      <td>3.33577</td>
      <td>3.611101</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(49,)</td>
      <td>(59,)</td>
      <td>3.39</td>
      <td>0.0</td>
      <td>3.73</td>
      <td>1.464745</td>
      <td>1.464609</td>
      <td>3.275743</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(61,)</td>
      <td>(1,)</td>
      <td>2.17</td>
      <td>0.0</td>
      <td>2.39</td>
      <td>3.359008</td>
      <td>3.023958</td>
      <td>3.548822</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(1,)</td>
      <td>(3,)</td>
      <td>2.60</td>
      <td>0.0</td>
      <td>2.86</td>
      <td>2.848296</td>
      <td>2.768219</td>
      <td>2.957035</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1,)</td>
      <td>(5, 6)</td>
      <td>2.37</td>
      <td>0.0</td>
      <td>3.83</td>
      <td>3.4225</td>
      <td>3.09684</td>
      <td>3.637181</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1,)</td>
      <td>(5, 6)</td>
      <td>2.37</td>
      <td>0.0</td>
      <td>3.83</td>
      <td>2.428948</td>
      <td>2.252369</td>
      <td>2.879062</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.281834</td>
      <td>2.19095</td>
      <td>2.432102</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.653978</td>
      <td>2.569607</td>
      <td>2.835856</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.90397</td>
      <td>2.719491</td>
      <td>3.033016</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.284899</td>
      <td>2.191569</td>
      <td>2.434081</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(26,)</td>
      <td>(28,)</td>
      <td>2.31</td>
      <td>0.0</td>
      <td>2.54</td>
      <td>2.86195</td>
      <td>2.698605</td>
      <td>2.976565</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>3.045022</td>
      <td>2.433392</td>
      <td>4.488527</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>3.048632</td>
      <td>2.430627</td>
      <td>4.489076</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.901609</td>
      <td>2.376105</td>
      <td>4.459983</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.849847</td>
      <td>2.352441</td>
      <td>4.317287</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.888419</td>
      <td>2.363328</td>
      <td>4.325934</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.880095</td>
      <td>2.364734</td>
      <td>4.322666</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(45,)</td>
      <td>(50,)</td>
      <td>2.75</td>
      <td>0.0</td>
      <td>3.02</td>
      <td>3.104936</td>
      <td>2.81712</td>
      <td>3.673281</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(45,)</td>
      <td>(49,)</td>
      <td>3.02</td>
      <td>0.0</td>
      <td>3.32</td>
      <td>2.938233</td>
      <td>2.604201</td>
      <td>3.590604</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(47,)</td>
      <td>(50,)</td>
      <td>2.26</td>
      <td>0.0</td>
      <td>2.49</td>
      <td>2.57032</td>
      <td>2.357912</td>
      <td>3.006302</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(47,)</td>
      <td>(49,)</td>
      <td>2.11</td>
      <td>0.0</td>
      <td>2.32</td>
      <td>2.500225</td>
      <td>2.367665</td>
      <td>2.884723</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(50,)</td>
      <td>(54, 55)</td>
      <td>2.60</td>
      <td>0.0</td>
      <td>6.06</td>
      <td>3.595042</td>
      <td>3.462645</td>
      <td>3.929524</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(50,)</td>
      <td>(54, 55)</td>
      <td>2.60</td>
      <td>0.0</td>
      <td>6.06</td>
      <td>2.382946</td>
      <td>2.192471</td>
      <td>3.189524</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(49,)</td>
      <td>(54, 55)</td>
      <td>3.31</td>
      <td>0.0</td>
      <td>7.11</td>
      <td>3.670357</td>
      <td>3.495487</td>
      <td>3.971517</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(49,)</td>
      <td>(54, 55)</td>
      <td>3.31</td>
      <td>0.0</td>
      <td>7.11</td>
      <td>2.536191</td>
      <td>2.250252</td>
      <td>3.296987</td>
    </tr>
    <tr>
      <th>20</th>
      <td>(59,)</td>
      <td>(63, 64)</td>
      <td>2.49</td>
      <td>0.0</td>
      <td>3.98</td>
      <td>2.75322</td>
      <td>2.444898</td>
      <td>3.635529</td>
    </tr>
    <tr>
      <th>20</th>
      <td>(59,)</td>
      <td>(63, 64)</td>
      <td>2.49</td>
      <td>0.0</td>
      <td>3.98</td>
      <td>2.930882</td>
      <td>2.611997</td>
      <td>3.511382</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(61,)</td>
      <td>(63, 64)</td>
      <td>2.08</td>
      <td>0.0</td>
      <td>3.47</td>
      <td>2.512062</td>
      <td>2.363789</td>
      <td>2.924943</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(61,)</td>
      <td>(63, 64)</td>
      <td>2.08</td>
      <td>0.0</td>
      <td>3.47</td>
      <td>2.369281</td>
      <td>2.257996</td>
      <td>2.668188</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#NOE_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pickle_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_dist</span><span class="p">,</span> <span class="n">NOE_dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if not multiple:</span>
<span class="c1">#     ax.violinplot(NOE_dist, positions=np.arange(len(NOE_dist)), widths=0.8, showmeans=True)</span>
<span class="c1">#     fig.tight_layout()</span>
<span class="c1">#     fig.savefig(snakemake.output.noe_plot)</span>
<span class="c1"># else:</span>
<span class="c1">#     if len(cis) &gt; 0:</span>
<span class="c1">#         axs[1].violinplot(NOE_dist_cis, positions=np.arange(len(NOE_dist_cis)), widths=0.8, showmeans=True)</span>
<span class="c1">#     if len(trans) &gt; 0:</span>
<span class="c1">#         axs[0].violinplot(NOE_dist_trans, positions=np.arange(len(NOE_dist_trans)), widths=0.8, showmeans=True)</span>
<span class="c1">#     fig.tight_layout()</span>
<span class="c1">#     fig.savefig(snakemake.output.noe_plot)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_61_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_61_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NOE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Atom 1</th>
      <th>Atom 2</th>
      <th>NMR exp</th>
      <th>lower bound</th>
      <th>upper bound</th>
      <th>md</th>
      <th>lower</th>
      <th>upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(3,)</td>
      <td>(26,)</td>
      <td>3.19</td>
      <td>0.0</td>
      <td>3.51</td>
      <td>4.255253</td>
      <td>4.092113</td>
      <td>4.639608</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(3,)</td>
      <td>(13, 14)</td>
      <td>1.83</td>
      <td>0.0</td>
      <td>3.16</td>
      <td>3.235446</td>
      <td>2.941103</td>
      <td>3.732762</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(3,)</td>
      <td>(13, 14)</td>
      <td>1.83</td>
      <td>0.0</td>
      <td>3.16</td>
      <td>2.299837</td>
      <td>2.191304</td>
      <td>3.113714</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(22,)</td>
      <td>(26,)</td>
      <td>2.93</td>
      <td>0.0</td>
      <td>3.22</td>
      <td>3.346273</td>
      <td>3.072609</td>
      <td>3.541959</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(19, 20)</td>
      <td>(26,)</td>
      <td>2.73</td>
      <td>0.0</td>
      <td>4.27</td>
      <td>3.097807</td>
      <td>2.786248</td>
      <td>3.543711</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(19, 20)</td>
      <td>(26,)</td>
      <td>2.73</td>
      <td>0.0</td>
      <td>4.27</td>
      <td>4.249252</td>
      <td>4.022555</td>
      <td>4.494861</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(16, 17)</td>
      <td>(26,)</td>
      <td>2.71</td>
      <td>0.0</td>
      <td>4.24</td>
      <td>3.478082</td>
      <td>2.606915</td>
      <td>4.803864</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(16, 17)</td>
      <td>(26,)</td>
      <td>2.71</td>
      <td>0.0</td>
      <td>4.24</td>
      <td>4.711501</td>
      <td>4.266601</td>
      <td>5.000795</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(13, 14)</td>
      <td>(26,)</td>
      <td>2.63</td>
      <td>0.0</td>
      <td>4.14</td>
      <td>2.902224</td>
      <td>2.664539</td>
      <td>3.437414</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(13, 14)</td>
      <td>(26,)</td>
      <td>2.63</td>
      <td>0.0</td>
      <td>4.14</td>
      <td>4.100673</td>
      <td>3.934479</td>
      <td>4.395087</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(47,)</td>
      <td>(59,)</td>
      <td>2.57</td>
      <td>0.0</td>
      <td>2.83</td>
      <td>3.463446</td>
      <td>3.33577</td>
      <td>3.611101</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(49,)</td>
      <td>(59,)</td>
      <td>3.39</td>
      <td>0.0</td>
      <td>3.73</td>
      <td>1.464745</td>
      <td>1.464609</td>
      <td>3.275743</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(61,)</td>
      <td>(1,)</td>
      <td>2.17</td>
      <td>0.0</td>
      <td>2.39</td>
      <td>3.359008</td>
      <td>3.023958</td>
      <td>3.548822</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(1,)</td>
      <td>(3,)</td>
      <td>2.60</td>
      <td>0.0</td>
      <td>2.86</td>
      <td>2.848296</td>
      <td>2.768219</td>
      <td>2.957035</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1,)</td>
      <td>(5, 6)</td>
      <td>2.37</td>
      <td>0.0</td>
      <td>3.83</td>
      <td>3.4225</td>
      <td>3.09684</td>
      <td>3.637181</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1,)</td>
      <td>(5, 6)</td>
      <td>2.37</td>
      <td>0.0</td>
      <td>3.83</td>
      <td>2.428948</td>
      <td>2.252369</td>
      <td>2.879062</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.281834</td>
      <td>2.19095</td>
      <td>2.432102</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.653978</td>
      <td>2.569607</td>
      <td>2.835856</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.90397</td>
      <td>2.719491</td>
      <td>3.033016</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(16, 17)</td>
      <td>(13, 14)</td>
      <td>1.73</td>
      <td>0.0</td>
      <td>4.19</td>
      <td>2.284899</td>
      <td>2.191569</td>
      <td>2.434081</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(26,)</td>
      <td>(28,)</td>
      <td>2.31</td>
      <td>0.0</td>
      <td>2.54</td>
      <td>2.86195</td>
      <td>2.698605</td>
      <td>2.976565</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>3.045022</td>
      <td>2.433392</td>
      <td>4.488527</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>3.048632</td>
      <td>2.430627</td>
      <td>4.489076</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.901609</td>
      <td>2.376105</td>
      <td>4.459983</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.849847</td>
      <td>2.352441</td>
      <td>4.317287</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.888419</td>
      <td>2.363328</td>
      <td>4.325934</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(28,)</td>
      <td>(35, 36, 37, 39, 40, 41)</td>
      <td>3.23</td>
      <td>0.0</td>
      <td>6.99</td>
      <td>2.880095</td>
      <td>2.364734</td>
      <td>4.322666</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(45,)</td>
      <td>(50,)</td>
      <td>2.75</td>
      <td>0.0</td>
      <td>3.02</td>
      <td>3.104936</td>
      <td>2.81712</td>
      <td>3.673281</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(45,)</td>
      <td>(49,)</td>
      <td>3.02</td>
      <td>0.0</td>
      <td>3.32</td>
      <td>2.938233</td>
      <td>2.604201</td>
      <td>3.590604</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(47,)</td>
      <td>(50,)</td>
      <td>2.26</td>
      <td>0.0</td>
      <td>2.49</td>
      <td>2.57032</td>
      <td>2.357912</td>
      <td>3.006302</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(47,)</td>
      <td>(49,)</td>
      <td>2.11</td>
      <td>0.0</td>
      <td>2.32</td>
      <td>2.500225</td>
      <td>2.367665</td>
      <td>2.884723</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(50,)</td>
      <td>(54, 55)</td>
      <td>2.60</td>
      <td>0.0</td>
      <td>6.06</td>
      <td>3.595042</td>
      <td>3.462645</td>
      <td>3.929524</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(50,)</td>
      <td>(54, 55)</td>
      <td>2.60</td>
      <td>0.0</td>
      <td>6.06</td>
      <td>2.382946</td>
      <td>2.192471</td>
      <td>3.189524</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(49,)</td>
      <td>(54, 55)</td>
      <td>3.31</td>
      <td>0.0</td>
      <td>7.11</td>
      <td>3.670357</td>
      <td>3.495487</td>
      <td>3.971517</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(49,)</td>
      <td>(54, 55)</td>
      <td>3.31</td>
      <td>0.0</td>
      <td>7.11</td>
      <td>2.536191</td>
      <td>2.250252</td>
      <td>3.296987</td>
    </tr>
    <tr>
      <th>20</th>
      <td>(59,)</td>
      <td>(63, 64)</td>
      <td>2.49</td>
      <td>0.0</td>
      <td>3.98</td>
      <td>2.75322</td>
      <td>2.444898</td>
      <td>3.635529</td>
    </tr>
    <tr>
      <th>20</th>
      <td>(59,)</td>
      <td>(63, 64)</td>
      <td>2.49</td>
      <td>0.0</td>
      <td>3.98</td>
      <td>2.930882</td>
      <td>2.611997</td>
      <td>3.511382</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(61,)</td>
      <td>(63, 64)</td>
      <td>2.08</td>
      <td>0.0</td>
      <td>3.47</td>
      <td>2.512062</td>
      <td>2.363789</td>
      <td>2.924943</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(61,)</td>
      <td>(63, 64)</td>
      <td>2.08</td>
      <td>0.0</td>
      <td>3.47</td>
      <td>2.369281</td>
      <td>2.257996</td>
      <td>2.668188</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dis_0 = NOE_dist[0]</span>
<span class="c1"># dis_0.tofile(&#39;/Users/daniel/Projects/research/03_macroconf/libs/pyreweight/test-data/distances.dat&#39;, sep=&quot;\n&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;cMD&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="n">pmf_plot</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;PMF plots. PMF vs. distance&#39;</span><span class="p">)</span>
        <span class="n">pmf_plot</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">pmf_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_pmf</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pmf_plot</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># save to image data</span>
        <span class="n">io_cis</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">io_trans</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pmf_plot_cis</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">io_cis</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="n">pmf_plot_cis</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pmf_plot_trans</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">io_trans</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="n">pmf_plot_trans</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">io_cis</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">img_cis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">io_cis</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">newshape</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pmf_plot_cis</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">pmf_plot_cis</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">io_cis</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">io_trans</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">img_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">io_trans</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">newshape</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pmf_plot_trans</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">pmf_plot_trans</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">io_trans</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_cis</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;cis&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_trans</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;trans&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="c1">#fig.suptitle(&#39;PMF plots. PMF vs. distance&#39;)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_pmf</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;not applicable.&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_pmf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_65_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_65_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">utils</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">])</span>
    <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">NOE_cis_t</span> <span class="o">=</span> <span class="n">NOE_cis</span>

        <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">])</span>
        <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;abs_dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">]))</span>

        <span class="n">NOE_cis_t</span> <span class="o">=</span> <span class="n">NOE_cis_t</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs_dev&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">NOE_cis_t</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">NOE_cis_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">NOE_cis_t</span> <span class="o">=</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="o">~</span><span class="n">NOE_cis_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;mergesort&#39;</span><span class="p">)</span>
        
        <span class="n">NOE_cis_t</span> <span class="o">=</span> <span class="n">NOE_cis_t</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">NOE_trans_t</span> <span class="o">=</span> <span class="n">NOE_trans</span>

        <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">])</span>
        <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;abs_dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">]))</span>

        <span class="n">NOE_trans_t</span> <span class="o">=</span> <span class="n">NOE_trans_t</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs_dev&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">NOE_trans_t</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">NOE_trans_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">NOE_trans_t</span> <span class="o">=</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="o">~</span><span class="n">NOE_trans_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;mergesort&#39;</span><span class="p">)</span>
        
        <span class="n">NOE_trans_t</span> <span class="o">=</span> <span class="n">NOE_trans_t</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    
    <span class="c1"># Merge cis/trans ? Or separate?</span>
    <span class="c1"># Separate:</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Remove duplicate values (keep value closest to experimental value)</span>
    <span class="n">NOE_test</span> <span class="o">=</span> <span class="n">NOE</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="c1"># if all exp values are 0: take middle between upper / lower bound as reference value</span>
        <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;upper bound&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;lower bound&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">])</span>
    <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;abs_dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">]))</span>

    <span class="n">NOE_test</span> <span class="o">=</span> <span class="n">NOE_test</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs_dev&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">NOE_test</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">NOE_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">NOE_test</span> <span class="o">=</span> <span class="n">NOE_test</span><span class="p">[</span><span class="o">~</span><span class="n">NOE_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;mergesort&#39;</span><span class="p">)</span>
    
    <span class="c1"># drop NaN values:</span>
    <span class="n">NOE_test</span> <span class="o">=</span> <span class="n">NOE_test</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">NOE_test</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute statistics</span>
<span class="c1"># CI via bootstrapping. Parameters:</span>
<span class="n">n_bootstrap</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">CI</span> <span class="o">=</span> <span class="mf">0.95</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_MAE</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">CI</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">MAE</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">)</span>

    <span class="c1"># bootstrap CI&#39;s</span>
    <span class="c1"># Compute errors/CI:</span>
    <span class="n">boot_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span><span class="n">md</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

        <span class="c1">#perform statistical eval</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">resample</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resample</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">boot_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Confidence intervals</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">CI</span><span class="o">+</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MAE - Mean absolute error</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># cis</span>
        <span class="n">MAE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_MAE</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">MAE</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># trans</span>
        <span class="n">MAE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_MAE</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">MAE</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">MAE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_MAE</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
    <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">MAE</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">NOE_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_MSE</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CI</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_boostrap</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="c1"># MSE - Mean signed error</span>
    <span class="n">MSE</span> <span class="o">=</span> <span class="n">dev</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># bootstrap CI&#39;s</span>
    <span class="c1"># Compute errors/CI:</span>
    <span class="n">boot_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>

        <span class="c1">#perform statistical eval</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">resample</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">boot_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Confidence intervals</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">CI</span><span class="o">+</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="c1">#plt.hist(boot_stats)</span>
    <span class="k">return</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MSE - Mean signed error</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># cis</span>
        <span class="n">MSE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_MSE</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">MSE</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># trans</span>
        <span class="n">MSE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_MSE</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">MSE</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">MSE</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_MSE</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">])</span>

    <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">MSE</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">NOE_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_RMSD</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">CI</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="c1"># RMSD - root mean squared error</span>
    <span class="n">RMSD</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># bootstrap CI&#39;s</span>
    <span class="c1"># Compute errors/CI:</span>
    <span class="n">boot_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">md</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

        <span class="c1">#perform statistical eval</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">resample</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resample</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">boot_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Confidence intervals</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">CI</span><span class="o">+</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RMSD</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RMSD - root mean squared error</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># cis</span>
        <span class="n">RMSD</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_RMSD</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;RMSD&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">RMSD</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># trans</span>
        <span class="n">RMSD</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_RMSD</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;RMSD&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">RMSD</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">RMSD</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_RMSD</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
    <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;RMSD&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">RMSD</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">NOE_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_pearsonr</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">CI</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="c1"># pearsonr</span>
    <span class="n">pearsonr</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#slope, intercept, pearsonr, p_value, std_err = scipy.stats.linregress(exp.to_list(), md.to_list())</span>

    <span class="c1"># bootstrap CI&#39;s</span>
    <span class="c1"># Compute errors/CI:</span>
    <span class="n">boot_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">md</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

        <span class="c1">#perform statistical eval</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">resample</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resample</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#_, _2, result, _3, _4 = scipy.stats.linregress(resample[0], resample[1])</span>
        <span class="n">boot_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#boot_stats.append(result)</span>

    <span class="c1"># Confidence intervals</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">CI</span><span class="o">+</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># cis</span>
        <span class="n">pearsonr</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_pearsonr</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># trans</span>
        <span class="n">pearsonr</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_pearsonr</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># pearsonr</span>
    <span class="n">pearsonr</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_pearsonr</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
    <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">NOE_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_kendalltau</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">CI</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">kendalltau</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># bootstrap CI&#39;s</span>
    <span class="c1"># Compute errors/CI:</span>
    <span class="n">boot_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">md</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

        <span class="c1">#perform statistical eval</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">resample</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resample</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">boot_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Confidence intervals</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">CI</span><span class="o">+</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">kendalltau</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#cis</span>
        <span class="n">kendalltau</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_kendalltau</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;kendalltau&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">kendalltau</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#trans</span>
        <span class="n">kendalltau</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_kendalltau</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;kendalltau&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">kendalltau</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Kendall&#39;s tau</span>
    <span class="n">kendalltau</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_kendalltau</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
    <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;kendalltau&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">kendalltau</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">NOE_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_chisquared</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">CI</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">chi_elements</span> <span class="o">=</span> <span class="p">(</span><span class="n">md</span> <span class="o">-</span> <span class="n">exp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">exp</span>
    <span class="n">chisq</span> <span class="o">=</span> <span class="n">chi_elements</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># bootstrap CI&#39;s</span>
    <span class="c1"># Compute errors/CI:</span>
    <span class="n">boot_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">chi_elements</span><span class="p">)</span>

        <span class="c1">#perform statistical eval</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">resample</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">boot_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Confidence intervals</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">CI</span><span class="o">+</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">CI</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">boot_stats</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chisq</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Chi squared</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># cis</span>
        <span class="n">chisq</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_chisquared</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;chisq&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">chisq</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_cis</span> <span class="o">=</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#trans</span>
        <span class="n">chisq</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_chisquared</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;chisq&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">chisq</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
        <span class="n">NOE_stat_trans</span> <span class="o">=</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">chisq</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">compute_chisquared</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
    <span class="n">append</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="s1">&#39;chisq&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">chisq</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">lower</span><span class="p">}</span>
    <span class="n">NOE_stats</span> <span class="o">=</span> <span class="n">NOE_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">NOE_stat_combined</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cis&#39;</span><span class="p">:</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="s1">&#39;trans&#39;</span><span class="p">:</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()}</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">NOE_stat_combined</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cis&#39;</span><span class="p">:</span> <span class="n">NOE_stat_cis</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">NOE_stat_combined</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trans&#39;</span><span class="p">:</span> <span class="n">NOE_stat_trans</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()}</span>
    <span class="n">src</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">json_dump</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_stats</span><span class="p">,</span> <span class="n">NOE_stat_combined</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">NOE_stats</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_stats</span><span class="p">)</span>
    <span class="n">NOE_stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># cis</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MD&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Experimental NOE value&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Experimental vs MD derived NOE values - cis&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#trans</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MD&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Experimental NOE value&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Experimental vs MD derived NOE values - trans&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_stat_plot</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;cMD&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;NMR exp&#39;</span><span class="p">],</span> <span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;MD&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Experimental NOE value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Experimental vs MD derived NOE values&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">snakemake</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">noe_stat_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d110be4b2d63f96_GaMD_processed_83_0.png" src="../_images/3d110be4b2d63f96_GaMD_processed_83_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># is the mean deviation significantly different than 0? if pvalue &lt; 5% -&gt; yes! We want: no! (does not deviate from exp. values)</span>
<span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_1sampResult(statistic=2.245283908733531, pvalue=0.035644292511966796)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">NOE_cis_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">NOE_trans_t</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">NOE_test</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DescribeResult(nobs=22, minmax=(-1.925255252845082, 1.1890076899260005), mean=0.291629569143305, variance=0.37114470195440064, skewness=-2.078135722895504, kurtosis=6.2322830696477745)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done
</pre></div>
</div>
</div>
</div>
</div>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"0725da713780423ca4a8705bd712bbc9": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "12c3113ba77044e2b594a7200d3a4abb": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "PlayModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "PlayModel", "_playing": false, "_repeat": false, "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "PlayView", "description": "", "description_tooltip": null, "disabled": false, "interval": 100, "layout": "IPY_MODEL_bf38d4e904d04c618cfce15b7adb43c0", "max": 2, "min": 0, "show_repeat": true, "step": 1, "style": "IPY_MODEL_837d5f62a7734a17a85b0317b1f87d18", "value": 0}}, "1c66dd2ba68047bbbd434694dc5a1e9a": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ButtonStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ButtonStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "button_color": null, "font_weight": ""}}, "273ae1a0875f4d4a8cfa1d0a9dba9ace": {"model_module": "nglview-js-widgets", "model_module_version": "3.0.1", "model_name": "ColormakerRegistryModel", "state": {"_dom_classes": [], "_model_module": "nglview-js-widgets", "_model_module_version": "3.0.1", "_model_name": "ColormakerRegistryModel", "_msg_ar": [], "_msg_q": [], "_ready": false, "_view_count": null, "_view_module": "nglview-js-widgets", "_view_module_version": "3.0.1", "_view_name": "ColormakerRegistryView", "layout": "IPY_MODEL_0725da713780423ca4a8705bd712bbc9"}}, "2a1051a9f8a6460a9b88523de6bbf77d": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "LinkModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "LinkModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": null, "source": ["IPY_MODEL_e65b05976bd141de9c4c321b1bc2cbd2", "max"], "target": ["IPY_MODEL_e51d4cc57d6a4c37bac65b97ef158333", "max_frame"]}}, "46069d96652b4ff9bb68422cb3b7acaf": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "LinkModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "LinkModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": null, "source": ["IPY_MODEL_12c3113ba77044e2b594a7200d3a4abb", "value"], "target": ["IPY_MODEL_e51d4cc57d6a4c37bac65b97ef158333", "frame"]}}, "59db85fbce594d0aa237ba9aa0a37633": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "LinkModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "LinkModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": null, "source": ["IPY_MODEL_12c3113ba77044e2b594a7200d3a4abb", "value"], "target": ["IPY_MODEL_e65b05976bd141de9c4c321b1bc2cbd2", "value"]}}, "5b77c1049dda41b3a817b6c07d1d716b": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ButtonModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ButtonModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ButtonView", "button_style": "", "description": "", "disabled": false, "icon": "compress", "layout": "IPY_MODEL_e3ac4ba5b2c44b768ceaeaefded955f8", "style": "IPY_MODEL_1c66dd2ba68047bbbd434694dc5a1e9a", "tooltip": ""}}, "5ffe82dacc094672bd215b5e2b6de216": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "SliderStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "SliderStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": "", "handle_color": null}}, "6f33260854fd4792822a298bb381217f": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "LinkModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "LinkModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": null, "source": ["IPY_MODEL_12c3113ba77044e2b594a7200d3a4abb", "max"], "target": ["IPY_MODEL_e51d4cc57d6a4c37bac65b97ef158333", "max_frame"]}}, "7e8b3ffc22c9458bbde299df73f58637": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "837d5f62a7734a17a85b0317b1f87d18": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "8bce6c36f22e49c9b2d7ff84f712933f": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "8f098f0d5f2e4377992103a34d2c992c": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_12c3113ba77044e2b594a7200d3a4abb", "IPY_MODEL_e65b05976bd141de9c4c321b1bc2cbd2"], "layout": "IPY_MODEL_bcf8532224114e368baab09dc9dcd232"}}, "bcf8532224114e368baab09dc9dcd232": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "bf38d4e904d04c618cfce15b7adb43c0": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "ca2810e9275b4b98a71e9c2875dab62a": {"buffers": [{"data": "", "encoding": "base64", "path": ["value"]}], "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ImageModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ImageModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ImageView", "format": "png", "height": "", "layout": "IPY_MODEL_ec1419d4a6d84f9ab64a41cb5b4cffe8", "width": "900.0"}}, "e3ac4ba5b2c44b768ceaeaefded955f8": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": "34px"}}, "e51d4cc57d6a4c37bac65b97ef158333": {"model_module": "nglview-js-widgets", "model_module_version": "3.0.1", "model_name": "NGLModel", "state": {"_camera_orientation": [], "_camera_str": "orthographic", "_dom_classes": [], "_gui_theme": null, "_ibtn_fullscreen": "IPY_MODEL_5b77c1049dda41b3a817b6c07d1d716b", "_igui": null, "_iplayer": "IPY_MODEL_8f098f0d5f2e4377992103a34d2c992c", "_model_module": "nglview-js-widgets", "_model_module_version": "3.0.1", "_model_name": "NGLModel", "_ngl_color_dict": {}, "_ngl_coordinate_resource": {}, "_ngl_full_stage_parameters": {}, "_ngl_msg_archive": [{"args": [{"binary": false, "data": "REMARK   1 CREATED WITH MDTraj 1.9.6, 2021-08-16\nCRYST1   39.673   39.673   39.673 109.47 109.47 109.47 P 1           1 \nMODEL        0\nATOM      1  N   SER A   0       3.265 -13.270   9.386  1.00  0.00           N  \nATOM      2  H   SER A   0       3.520 -12.474   9.952  1.00  0.00           H  \nATOM      3  CA  SER A   0       2.370 -12.988   8.299  1.00  0.00           C  \nATOM      4  HA  SER A   0       2.679 -13.525   7.402  1.00  0.00           H  \nATOM      5  CB  SER A   0       0.966 -13.366   8.800  1.00  0.00           C  \nATOM      6  HB2 SER A   0       0.199 -13.382   8.026  1.00  0.00           H  \nATOM      7  HB3 SER A   0       1.010 -14.430   9.032  1.00  0.00           H  \nATOM      8  OG  SER A   0       0.384 -12.561   9.885  1.00  0.00           O  \nATOM      9  HG  SER A   0      -0.053 -13.242  10.402  1.00  0.00           H  \nATOM     10  C   SER A   0       2.520 -11.446   8.016  1.00  0.00           C  \nATOM     11  O   SER A   0       3.325 -10.789   8.663  1.00  0.00           O  \nATOM     12  N   PRO A   1       1.709 -10.775   7.148  1.00  0.00           N  \nATOM     13  CD  PRO A   1       0.897 -11.480   6.172  1.00  0.00           C  \nATOM     14  HD2 PRO A   1      -0.053 -11.842   6.564  1.00  0.00           H  \nATOM     15  HD3 PRO A   1       1.423 -12.282   5.653  1.00  0.00           H  \nATOM     16  CG  PRO A   1       0.664 -10.359   5.093  1.00  0.00           C  \nATOM     17  HG2 PRO A   1      -0.280 -10.416   4.552  1.00  0.00           H  \nATOM     18  HG3 PRO A   1       1.495 -10.300   4.391  1.00  0.00           H  \nATOM     19  CB  PRO A   1       0.537  -9.172   5.985  1.00  0.00           C  \nATOM     20  HB2 PRO A   1      -0.379  -9.171   6.576  1.00  0.00           H  \nATOM     21  HB3 PRO A   1       0.638  -8.259   5.399  1.00  0.00           H  \nATOM     22  CA  PRO A   1       1.634  -9.359   7.009  1.00  0.00           C  \nATOM     23  HA  PRO A   1       2.620  -9.038   6.676  1.00  0.00           H  \nATOM     24  C   PRO A   1       1.261  -8.690   8.342  1.00  0.00           C  \nATOM     25  O   PRO A   1       1.659  -7.541   8.639  1.00  0.00           O  \nATOM     26  N   LEU A   2       0.510  -9.358   9.300  1.00  0.00           N  \nATOM     27  H   LEU A   2       0.242 -10.311   9.101  1.00  0.00           H  \nATOM     28  CA  LEU A   2       0.133  -8.815  10.613  1.00  0.00           C  \nATOM     29  HA  LEU A   2      -0.009  -7.736  10.567  1.00  0.00           H  \nATOM     30  CB  LEU A   2      -1.287  -9.270  10.886  1.00  0.00           C  \nATOM     31  HB2 LEU A   2      -1.398 -10.314  10.592  1.00  0.00           H  \nATOM     32  HB3 LEU A   2      -1.380  -9.288  11.972  1.00  0.00           H  \nATOM     33  CG  LEU A   2      -2.519  -8.474  10.341  1.00  0.00           C  \nATOM     34  HG  LEU A   2      -2.380  -7.937   9.403  1.00  0.00           H  \nATOM     35  CD1 LEU A   2      -3.794  -9.262  10.182  1.00  0.00           C  \nATOM     36 HD11 LEU A   2      -4.143  -9.758  11.087  1.00  0.00           H  \nATOM     37 HD12 LEU A   2      -4.597  -8.548   9.999  1.00  0.00           H  \nATOM     38 HD13 LEU A   2      -3.823  -9.936   9.326  1.00  0.00           H  \nATOM     39  CD2 LEU A   2      -2.813  -7.415  11.322  1.00  0.00           C  \nATOM     40 HD21 LEU A   2      -3.713  -6.844  11.095  1.00  0.00           H  \nATOM     41 HD22 LEU A   2      -2.943  -7.868  12.304  1.00  0.00           H  \nATOM     42 HD23 LEU A   2      -1.939  -6.764  11.288  1.00  0.00           H  \nATOM     43  C   LEU A   2       1.148  -9.149  11.720  1.00  0.00           C  \nATOM     44  O   LEU A   2       1.553  -8.252  12.462  1.00  0.00           O  \nATOM     45  N   ASN A   3       1.661 -10.422  11.824  1.00  0.00           N  \nATOM     46  H   ASN A   3       1.345 -11.189  11.248  1.00  0.00           H  \nATOM     47  CA  ASN A   3       2.812 -10.668  12.621  1.00  0.00           C  \nATOM     48  HA  ASN A   3       3.530  -9.858  12.495  1.00  0.00           H  \nATOM     49  CB  ASN A   3       2.377 -10.682  14.131  1.00  0.00           C  \nATOM     50  HB2 ASN A   3       1.894  -9.717  14.287  1.00  0.00           H  \nATOM     51  HB3 ASN A   3       1.737 -11.560  14.218  1.00  0.00           H  \nATOM     52  CG  ASN A   3       3.570 -10.772  15.015  1.00  0.00           C  \nATOM     53  OD1 ASN A   3       4.681 -10.710  14.679  1.00  0.00           O  \nATOM     54  ND2 ASN A   3       3.299 -11.043  16.251  1.00  0.00           N  \nATOM     55 HD21 ASN A   3       4.045 -11.250  16.900  1.00  0.00           H  \nATOM     56 HD22 ASN A   3       2.336 -11.139  16.538  1.00  0.00           H  \nATOM     57  C   ASN A   3       3.624 -11.907  12.153  1.00  0.00           C  \nATOM     58  O   ASN A   3       4.709 -11.668  11.652  1.00  0.00           O  \nATOM     59  N   ASP A   4       3.193 -13.124  12.163  1.00  0.00           N  \nATOM     60  H   ASP A   4       2.314 -13.462  12.528  1.00  0.00           H  \nATOM     61  CA  ASP A   4       3.890 -14.245  11.474  1.00  0.00           C  \nATOM     62  HA  ASP A   4       4.931 -13.984  11.283  1.00  0.00           H  \nATOM     63  CB  ASP A   4       3.765 -15.552  12.336  1.00  0.00           C  \nATOM     64  HB2 ASP A   4       4.342 -16.304  11.798  1.00  0.00           H  \nATOM     65  HB3 ASP A   4       4.253 -15.520  13.310  1.00  0.00           H  \nATOM     66  CG  ASP A   4       2.314 -15.974  12.621  1.00  0.00           C  \nATOM     67  OD1 ASP A   4       1.430 -15.118  12.770  1.00  0.00           O  \nATOM     68  OD2 ASP A   4       2.033 -17.210  12.832  1.00  0.00           O  \nATOM     69  C   ASP A   4       3.448 -14.456   9.994  1.00  0.00           C  \nATOM     70  O   ASP A   4       3.230 -15.557   9.452  1.00  0.00           O  \nTER      71      ASP A   4\nENDMDL\nEND\n", "type": "blob"}], "kwargs": {"defaultRepresentation": true, "ext": "pdb", "name": "nglview.adaptor.MDTrajTrajectory"}, "methodName": "loadFile", "reconstruc_color_scheme": false, "target": "Stage", "type": "call_method"}], "_ngl_original_stage_parameters": {}, "_ngl_repr_dict": {}, "_ngl_serialize": false, "_ngl_version": "", "_ngl_view_id": [], "_player_dict": {}, "_scene_position": {}, "_scene_rotation": {}, "_synced_model_ids": [], "_synced_repr_model_ids": [], "_view_count": null, "_view_height": "", "_view_module": "nglview-js-widgets", "_view_module_version": "3.0.1", "_view_name": "NGLView", "_view_width": "", "background": "white", "frame": 0, "gui_style": null, "layout": "IPY_MODEL_8bce6c36f22e49c9b2d7ff84f712933f", "max_frame": 2, "n_components": 0, "picked": {}}}, "e65b05976bd141de9c4c321b1bc2cbd2": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "IntSliderModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "IntSliderModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "IntSliderView", "continuous_update": true, "description": "", "description_tooltip": null, "disabled": false, "layout": "IPY_MODEL_7e8b3ffc22c9458bbde299df73f58637", "max": 2, "min": 0, "orientation": "horizontal", "readout": true, "readout_format": "d", "step": 1, "style": "IPY_MODEL_5ffe82dacc094672bd215b5e2b6de216", "value": 0}}, "ec1419d4a6d84f9ab64a41cb5b4cffe8": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "d-cru/test_report",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./22"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Daniel Crusius<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>